import{_ as pe}from"./DJvvu5Qf.js";import{_ as ue,a5 as ve,E as me,W as G,G as he,n as fe,N as be,c as n,a as t,b as o,C as s,M as F,t as d,w as v,T as h,F as S,B as P,J,S as ge,r as y,m as M,o as c}from"./iM9L4znb.js";import{c as _e,f as xe,b as w,g as E,u as ye,F as p,E as u}from"./BoZTFlx3.js";import{_ as we}from"./36PNen53.js";import{a as $e,u as Ce,b as W}from"./DpQHvKxy.js";import{u as Ee}from"./BJWqw1LH.js";import{T as ke}from"./C90w-sFa.js";import{X as qe}from"./T__e-23a.js";import{P as Ae}from"./Bo92QmbI.js";import{c as De}from"./CMPM1k27.js";import{M as Fe}from"./xltBLSyb.js";import{C as Ie}from"./Bs5UitBi.js";import"./BdZVd_Jo.js";import"./B7EQjeK0.js";import"./CxRbHSOd.js";const Ne=De("cloud-upload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]),Le={class:"min-h-screen w-full relative overflow-hidden p-6 sm:p-10"},Se={class:"w-full max-w-2xl mx-auto mb-6"},Pe={key:0,class:"w-full max-w-2xl bg-white/40 backdrop-blur-md rounded-[2.5rem] p-6 md:p-10 border border-white/60 mx-auto z-10 shadow-xl"},Me={class:"flex justify-start mb-8"},je={class:"bg-white/50 p-1.5 rounded-2xl flex items-center relative w-48 shadow-sm border border-white/60"},ze={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Re={class:"flex flex-col gap-2"},Te={class:"text-xs font-bold opacity-70"},Be=["placeholder"],Ue={class:"flex flex-col gap-2"},Oe={class:"text-xs font-bold opacity-70"},Ge={class:"flex flex-col gap-2"},Je={class:"text-xs font-bold opacity-70"},We=["placeholder"],Xe={class:"flex flex-col gap-2"},He={class:"text-xs font-bold opacity-70"},Ke={disabled:"",value:""},Qe=["value"],Ye={class:"flex flex-col gap-2"},Ze={class:"text-xs font-bold opacity-70"},Ve={disabled:"",value:""},et={value:1},tt={value:0},st={class:"flex flex-col gap-2"},it={class:"text-xs font-bold opacity-70"},lt={key:0,class:"grid grid-cols-3 gap-3 mb-3"},at=["src"],ot=["onClick"],rt=["onChange"],dt={key:0,class:"grid grid-cols-3 gap-2 w-full"},nt=["src"],ct=["onClick"],pt={class:"flex items-center justify-center text-xs text-[#8F300E] font-bold bg-white/50 rounded-lg aspect-square border border-dashed border-[#8F300E]/30"},ut={key:1,class:"text-gray-500 group-hover:text-[#8F300E] flex flex-col items-center"},vt={class:"text-xs"},mt={class:"flex flex-col gap-2"},ht={class:"text-xs font-bold opacity-70"},ft=["placeholder"],bt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},gt={class:"flex flex-col gap-2"},_t={class:"text-xs font-bold opacity-70"},xt=["placeholder"],yt={class:"flex flex-col gap-2"},wt={class:"text-xs font-bold opacity-70"},$t={class:"pt-4 border-t border-gray-200/20"},Ct={class:"flex flex-col gap-2"},Et={class:"text-xs font-bold opacity-70"},kt={class:"flex items-center gap-2 overflow-hidden"},qt={key:0,class:"text-gray-700 truncate"},At={key:1,class:"text-gray-400"},Dt={class:"flex flex-col gap-2 mt-4"},Ft={class:"text-xs font-bold opacity-70"},It=["placeholder"],Nt={class:"pt-4"},Lt=["disabled"],St={key:0},Pt={key:1},Mt={key:1,class:"flex items-center justify-center min-h-[400px]"},k="w-full bg-white/40 border border-gray-100/50 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-1 focus:ring-[#8F300E]/50 focus:bg-white/60 transition-all placeholder:text-gray-400",X="w-full bg-white/40 border border-gray-100/50 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-1 focus:ring-[#8F300E]/50 focus:bg-white/60 transition-all text-gray-700",H="w-full bg-white/40 border border-gray-100/50 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-1 focus:ring-[#8F300E]/50 focus:bg-white/60 transition-all placeholder:text-gray-400 resize-none",f="border-red-500/50 focus:ring-red-500/20 bg-red-50/50",jt={__name:"[id]",async setup(zt){let b,q;const I=ve().params.id,{t:r,locale:K}=me(),Q=M(()=>K.value==="ar"),Y=_e({titleAr:w().required(r("validation.required","مطلوب")).label(r("devices.nameAr","اسم الجهاز (عربي)")),titleEn:w().required("Required").label(r("devices.nameEn","اسم الجهاز (إنجليزي)")),supplierName:w().required(r("validation.required","مطلوب")).label(r("devices.supplier","اسم المورد")),deviceClassId:E().required(r("validation.required","مطلوب")).label(r("devices.class","الفئة")),isNew:E().required(r("validation.required","مطلوب")).label(r("devices.condition","حالة الجهاز")),lat:E().required(r("validation.required","مطلوب")).label(r("devices.lat","خط العرض")),lng:E().required(r("validation.required","مطلوب")).label(r("devices.lng","خط الطول")),mapDesc:w().required(r("validation.required","مطلوب")).label(r("devices.locationDesc","وصف الموقع")),price:E().required(r("validation.required","مطلوب")).label(r("devices.priceLabel","السعر")),descriptionAr:w().required(r("validation.required","مطلوب")).label(r("devices.descAr","وصف الجهاز (عربي)")),descriptionEn:w().required("Required").label(r("devices.descEn","وصف الجهاز (إنجليزي)")),images:xe().nullable().label(r("devices.images","صور الجهاز"))}),{handleSubmit:Z,setValues:V,values:m,errors:j,setFieldValue:N}=ye({validationSchema:Y}),L=y(!1),$=y("sale"),C=y([]),{data:ee}=([b,q]=G(()=>W("/device-classes")),b=await b,q(),b),te=M(()=>(ee.value?.data||[]).map(i=>({value:i.id,label:i.name}))),{delete:se}=$e(),{upload:ie}=Ce(),A=Ee(),le=he(),D=y(!1),{data:ae,pending:z,error:Tt}=([b,q]=G(()=>W(`/machine-details/${I}`)),b=await b,q(),b),R=M(()=>ae.value?.data);fe(R,e=>{e&&(V({titleAr:e.title_ar,titleEn:e.title_en,supplierName:e.supplier_name||e.supplier_name_ar,deviceClassId:e.device_class_id,isNew:e.is_new?1:0,price:e.price,descriptionAr:e.description_ar,descriptionEn:e.description_en,lat:e.lat,lng:e.lng,mapDesc:e.map_desc,images:[]}),$.value=e.type,C.value=e.images||[])},{immediate:!0});const T=y(null),g=y(new Map);function oe(){T.value.click()}function re(e,i){const x=Array.from(e.target.files||[]);x.length&&(x.forEach(l=>{if(!g.value.has(l)){const a=URL.createObjectURL(l);g.value.set(l,a)}}),i(Array.from(g.value.keys())))}function de(e,i){g.value.delete(e),i(Array.from(g.value.keys()))}const ne=e=>{N("lat",e.lat),N("lng",e.lng),N("mapDesc",e.address)},ce=async e=>{if(confirm(r("devices.confirmDeleteImg","هل أنت متأكد من حذف هذه الصورة؟")))try{await se(`/delete-machine-img/${e}`),A.success(r("devices.deleteImgSuccess","تم حذف الصورة بنجاح")),C.value=C.value.filter(i=>i.id!==e)}catch{A.error(r("devices.deleteImgError","فشل حذف الصورة"))}};function B(e){return $.value===e?"flex-1 py-1.5 text-sm font-bold rounded-xl bg-[#8F300E] text-white shadow-md transition-all":"flex-1 py-1.5 text-sm font-bold rounded-xl text-gray-500 hover:bg-white/40 transition-all"}const U=Z(async e=>{D.value=!0;try{const i=new FormData;i.append("title[ar]",e.titleAr),i.append("title[en]",e.titleEn),i.append("supplier_name",e.supplierName),i.append("price",e.price),i.append("device_class_id",e.deviceClassId),i.append("is_new",e.isNew),i.append("type",$.value),i.append("description[ar]",e.descriptionAr),i.append("description[en]",e.descriptionEn),i.append("lat",e.lat),i.append("lng",e.lng),i.append("map_desc",e.mapDesc),e.images&&e.images.length&&e.images.forEach(x=>{i.append("images[]",x)}),await ie(`/edit-machine/${I}?_method=put`,i),A.success(r("devices.editSuccess","تم تعديل الجهاز بنجاح!")),be(le("/profile/more/devices"))}catch(i){A.error(i.error||r("devices.editError","حدث خطأ أثناء تعديل الجهاز"))}finally{D.value=!1}});return(e,i)=>{const x=pe;return c(),n("div",Le,[t("div",Se,[o(x,{items:[{label:e.$t("devices.breadcrumb.more","المزيد"),to:"/profile/more",active:!1},{label:e.$t("devices.breadcrumb.devices","الأجهزة"),to:"/profile/more/devices",active:!1},{label:e.$t("devices.edit","تعديل جهاز"),to:`/profile/more/devices/edit/${s(I)}`,active:!0}],direction:Q.value?"rtl":"ltr"},null,8,["items","direction"])]),!s(z)&&R.value?(c(),n("div",Pe,[t("div",Me,[t("div",je,[t("button",{type:"button",onClick:i[0]||(i[0]=l=>$.value="sale"),class:F(B("sale"))},d(e.$t("devices.sale","بيع")),3),t("button",{type:"button",onClick:i[1]||(i[1]=l=>$.value="rent"),class:F(B("rent"))},d(e.$t("devices.rent","إيجار")),3)])]),t("form",{onSubmit:i[4]||(i[4]=(...l)=>s(U)&&s(U)(...l)),class:"space-y-4"},[t("div",ze,[t("div",Re,[t("label",Te,d(e.$t("devices.nameAr","اسم الجهاز (عربي)")),1),o(s(p),{name:"titleAr"},{default:v(({field:l,meta:a})=>[t("input",h(l,{placeholder:e.$t("devices.nameArPlaceholder","اسم الجهاز"),class:[k,a.touched&&a.invalid&&f]}),null,16,Be)]),_:1}),o(s(u),{name:"titleAr",class:"text-red-500 text-xs pr-1"})]),t("div",Ue,[t("label",Oe,d(e.$t("devices.nameEn","اسم الجهاز (إنجليزي)")),1),o(s(p),{name:"titleEn"},{default:v(({field:l,meta:a})=>[t("input",h(l,{placeholder:"Device Name",dir:"ltr",class:[k,a.touched&&a.invalid&&f]}),null,16)]),_:1}),o(s(u),{name:"titleEn",class:"text-red-500 text-xs pr-1"})])]),t("div",Ge,[t("label",Je,d(e.$t("devices.supplier","اسم المورد")),1),o(s(p),{name:"supplierName"},{default:v(({field:l,meta:a})=>[t("input",h(l,{placeholder:e.$t("devices.supplierPlaceholder","اسم المورد"),class:[k,a.touched&&a.invalid&&f]}),null,16,We)]),_:1}),o(s(u),{name:"supplierName",class:"text-red-500 text-xs pr-1"})]),t("div",Xe,[t("label",He,d(e.$t("devices.class","الفئة")),1),o(s(p),{name:"deviceClassId"},{default:v(({field:l,meta:a})=>[t("select",h(l,{class:[X,a.touched&&a.invalid&&f]}),[t("option",Ke,d(e.$t("devices.selectClass","اختر الفئة")),1),(c(!0),n(S,null,P(te.value,_=>(c(),n("option",{key:_.value,value:_.value},d(_.label),9,Qe))),128))],16)]),_:1}),o(s(u),{name:"deviceClassId",class:"text-red-500 text-xs pr-1"})]),t("div",Ye,[t("label",Ze,d(e.$t("devices.condition","حالة الجهاز")),1),o(s(p),{name:"isNew"},{default:v(({field:l,meta:a})=>[t("select",h(l,{class:[X,a.touched&&a.invalid&&f]}),[t("option",Ve,d(e.$t("devices.selectCondition","اختر حالة الجهاز")),1),t("option",et,d(e.$t("devices.new","جديد")),1),t("option",tt,d(e.$t("devices.used","مستعمل")),1)],16)]),_:1}),o(s(u),{name:"isNew",class:"text-red-500 text-xs pr-1"})]),t("div",st,[t("label",it,d(e.$t("devices.images","صور الجهاز")),1),C.value.length>0?(c(),n("div",lt,[(c(!0),n(S,null,P(C.value,l=>(c(),n("div",{key:l.id,class:"relative aspect-square rounded-xl overflow-hidden border border-black/5 shadow-sm group"},[t("img",{src:l.image,class:"w-full h-full object-cover"},null,8,at),t("button",{type:"button",onClick:a=>ce(l.id),class:"absolute top-1 right-1 bg-red-500/80 text-white p-1 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity"},[o(s(ke),{size:14})],8,ot)]))),128))])):J("",!0),o(s(p),{name:"images"},{default:v(({field:l,meta:a})=>[t("div",{onClick:oe,class:F(["w-full bg-white/40 min-h-[6rem] rounded-xl border-2 border-dashed border-gray-400/30 flex flex-col items-center justify-center cursor-pointer hover:bg-white/60 transition overflow-hidden relative group p-4",[a.touched&&a.invalid&&"border-red-500/50"]])},[t("input",{type:"file",ref_key:"fileInput",ref:T,class:"hidden",accept:"image/*",multiple:"",onChange:_=>re(_,l.onChange)},null,40,rt),g.value.size>0?(c(),n("div",dt,[(c(!0),n(S,null,P(g.value,([_,O])=>(c(),n("div",{key:O,class:"relative aspect-square rounded-lg overflow-hidden border border-black/10 group"},[t("img",{src:O,class:"w-full h-full object-cover"},null,8,nt),t("button",{type:"button",onClick:ge(Bt=>de(_,l.onChange),["stop"]),class:"absolute top-1 right-1 bg-red-500/80 text-white p-1 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity"},[o(s(qe),{size:14})],8,ct)]))),128)),t("div",pt,[o(s(Ae),{size:20})])])):(c(),n("div",ut,[o(s(Ne),{size:24,class:"mb-2 opacity-60"}),t("span",vt,d(e.$t("devices.uploadImages","اضغط لرفع صور إضافية")),1)]))],2)]),_:1}),o(s(u),{name:"images",class:"text-red-500 text-xs pr-1"})]),t("div",mt,[t("label",ht,d(e.$t("devices.priceLabel","السعر")),1),o(s(p),{name:"price"},{default:v(({field:l,meta:a})=>[t("input",h(l,{type:"number",placeholder:e.$t("devices.priceLabel","السعر"),class:[k,a.touched&&a.invalid&&f]}),null,16,ft)]),_:1}),o(s(u),{name:"price",class:"text-red-500 text-xs pr-1"})]),t("div",bt,[t("div",gt,[t("label",_t,d(e.$t("devices.descAr","وصف الجهاز (عربي)")),1),o(s(p),{name:"descriptionAr"},{default:v(({field:l,meta:a})=>[t("textarea",h(l,{placeholder:e.$t("devices.descArPlaceholder","وصف الجهاز"),rows:"4",class:[H,a.touched&&a.invalid&&f]}),null,16,xt)]),_:1}),o(s(u),{name:"descriptionAr",class:"text-red-500 text-xs pr-1"})]),t("div",yt,[t("label",wt,d(e.$t("devices.descEn","وصف الجهاز (إنجليزي)")),1),o(s(p),{name:"descriptionEn"},{default:v(({field:l,meta:a})=>[t("textarea",h(l,{placeholder:"Device Description",dir:"ltr",rows:"4",class:[H,a.touched&&a.invalid&&f]}),null,16)]),_:1}),o(s(u),{name:"descriptionEn",class:"text-red-500 text-xs pr-1"})])]),t("div",$t,[t("div",Ct,[t("label",Et,d(e.$t("devices.location","الموقع")),1),t("div",{onClick:i[2]||(i[2]=l=>L.value=!0),class:F(["w-full bg-white/40 border border-gray-100/50 rounded-xl px-4 py-3 text-sm cursor-pointer hover:bg-white/60 transition-all flex items-center justify-between group",[s(j).lat||s(j).lng?"border-red-500/50 bg-red-50/50":""]])},[t("div",kt,[o(s(Fe),{class:"w-4 h-4 text-[#8F300E] shrink-0"}),s(m).lat&&s(m).lng?(c(),n("span",qt,d(s(m).mapDesc||`${s(m).lat}, ${s(m).lng}`),1)):(c(),n("span",At,d(e.$t("devices.selectLocationOnMap","اختر الموقع من الخريطة")),1))]),o(s(Ie),{class:"w-4 h-4 text-gray-400 group-hover:text-[#8F300E] transition-colors"})],2),o(s(p),{name:"lat",type:"hidden"}),o(s(p),{name:"lng",type:"hidden"}),o(s(u),{name:"lat",class:"text-red-500 text-xs pr-1"})]),t("div",Dt,[t("label",Ft,d(e.$t("devices.locationDesc","وصف الموقع بالتفصيل")),1),o(s(p),{name:"mapDesc"},{default:v(({field:l,meta:a})=>[t("input",h(l,{placeholder:e.$t("devices.locationPlaceholder","مثال: الرياض، حي الملقا"),class:[k,a.touched&&a.invalid&&f]}),null,16,It)]),_:1}),o(s(u),{name:"mapDesc",class:"text-red-500 text-xs pr-1"})])]),o(we,{"is-open":L.value,"initial-lat":s(m).lat?Number(s(m).lat):24.7136,"initial-lng":s(m).lng?Number(s(m).lng):46.6753,onClose:i[3]||(i[3]=l=>L.value=!1),onLocationSelected:ne},null,8,["is-open","initial-lat","initial-lng"]),t("div",Nt,[t("button",{type:"submit",class:"w-full py-4 text-white font-bold text-lg rounded-xl shadow-lg bg-gradient-to-r from-[#8F300E] to-[#D2592D] hover:shadow-xl hover:scale-[1.01] transition-all disabled:opacity-50 disabled:cursor-not-allowed",disabled:D.value},[D.value?(c(),n("span",St,d(e.$t("devices.saving","جاري التعديل...")),1)):(c(),n("span",Pt,d(e.$t("devices.saveChanges","حفظ التعديلات")),1))],8,Lt)])],32)])):s(z)?(c(),n("div",Mt,[...i[5]||(i[5]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-4 border-[#8F300E] border-t-transparent"},null,-1)])])):J("",!0),i[6]||(i[6]=t("div",{class:"fixed inset-0 pointer-events-none -z-10 bg-[#E8E0DA]/30"},[t("div",{class:"absolute top-[-20%] left-[-10%] w-[60%] h-[60%] bg-[#D2592D]/5 rounded-full blur-[120px]"}),t("div",{class:"absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-[#8F300E]/10 rounded-full blur-[100px]"})],-1))])}}},is=ue(jt,[["__scopeId","data-v-ec462ad2"]]);export{is as default};
