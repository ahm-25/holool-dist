import{c as p,o as m,a as o,t as c,d as Z,S as k,b as f,C as a,E as tt,H as et,r as v,W as ot,k as st,a0 as at,n as nt,g as rt,J as y,F as it,B as lt,O as j,P as L,M as B,Y as E,A as ct,R as dt}from"./OI3PzNV2.js";import{_ as ut}from"./e2BhSMQC.js";import{T as mt}from"./D8tzh7tL.js";import{P as T}from"./CGGGxzb9.js";import{M as pt}from"./Bez2qNnN.js";import{_ as ht}from"./BgSPFiyZ.js";import{_ as ft}from"./C4N1KqaF.js";import{u as bt}from"./CYfhutIQ.js";import{c as vt,b as O,u as gt}from"./B-tkdhUT.js";import{a as yt,u as _t,b as xt}from"./F73BFBEp.js";import"./CpGMb49Z.js";import"./D3vptdOU.js";import"./D32ptye1.js";import"./DG3z_j9F.js";import"./C37uFHYe.js";const wt={class:"flex items-start justify-between"},$t={class:"flex gap-4 text-right"},kt={class:"w-20 h-20 rounded-lg overflow-hidden border-2 border-white shadow-sm shrink-0"},Ct=["src","alt"],Mt={class:"flex flex-col"},qt={class:"font-bold text-lg text-gray-900"},Ft={class:"text-sm text-gray-600 mb-2"},St={class:"text-[#A63C12] font-bold flex items-center gap-1"},At={class:"flex flex-col justify-between h-full min-h-[80px] items-end"},Dt={class:"mt-4 flex items-center bg-[#F5EBE0]/80 rounded-full px-2 py-1 border border-[#A63C12]/30"},jt={class:"mx-3 font-bold text-gray-800 w-4 text-center"},Lt=["disabled"],Bt={__name:"CartItem",props:{item:{type:Object,required:!0}},emits:["updateQuantity","remove","click"],setup(n){return(d,r)=>(m(),p("div",{onClick:r[3]||(r[3]=i=>d.$emit("click",n.item)),class:"bg-white/40 backdrop-blur-sm rounded-xl p-4 mb-4 border border-white/50 shadow-sm hover:shadow-md transition-shadow cursor-pointer"},[o("div",wt,[o("div",$t,[o("div",kt,[o("img",{src:n.item.image,alt:n.item.name,class:"w-full h-full object-cover"},null,8,Ct)]),o("div",Mt,[o("h3",qt,c(n.item.name),1),o("p",Ft,c(n.item.category),1),o("p",St,[Z(c(n.item.price*n.item.quantity)+" ",1),r[4]||(r[4]=o("img",{src:ut,class:"w-4 h-4 object-contain",alt:"SAR"},null,-1))])])]),o("div",At,[o("button",{onClick:r[0]||(r[0]=k(i=>d.$emit("remove",n.item.id),["stop"])),class:"text-red-500 hover:text-red-700 p-1 transition-colors"},[f(a(mt),{size:"20"})]),o("div",Dt,[o("button",{onClick:r[1]||(r[1]=k(i=>d.$emit("updateQuantity",n.item.id,1),["stop"])),class:"w-6 h-6 flex items-center justify-center background-btn text-white rounded-full hover:bg-black transition-colors"},[f(a(T),{size:"12"})]),o("span",jt,c(n.item.quantity),1),o("button",{onClick:r[2]||(r[2]=k(i=>d.$emit("updateQuantity",n.item.id,-1),["stop"])),disabled:n.item.quantity<=1,class:"w-6 h-6 flex items-center justify-center bg-gray-900 text-white rounded-full hover:bg-black transition-colors"},[f(a(pt),{size:"12"})],8,Lt)])])])]))}},Et={class:"container mx-auto"},Ot={class:"min-h-screen p-4 md:p-8 flex justify-center font-sans"},Tt={class:"w-full flex flex-col lg:flex-row gap-6 justify-center"},zt={class:"w-full text-center lg:w-2/3"},Pt={key:0,class:"bg-white/30 backdrop-blur-sm rounded-3xl p-12 text-center"},It={class:"text-xl text-gray-600"},Qt={key:0,class:"w-full lg:w-1/3 bg-white/40 backdrop-blur-md rounded-3xl p-6 shadow-xl border border-white/50 h-fit sticky top-8"},Rt={class:"mb-6"},Nt={class:"block text-gray-700 font-bold mb-2 text-right"},Ut={class:"relative"},Vt=["placeholder"],Ht={class:"border border-current rounded-full p-0.5"},Jt={key:0,class:"text-red-500 text-sm mt-1 block text-right"},Wt={class:"mb-8"},Yt={class:"block text-gray-700 font-bold mb-2 text-right"},Gt=["placeholder"],Kt={key:0,class:"text-red-500 text-sm mt-1 block text-right"},he={__name:"index",async setup(n){let d,r;const{t:i}=tt(),{success:C,error:M}=bt();et();const l=v([]),_=v(!1),x=v(!1),w=v(24.7136),$=v(46.6753),z=vt({location:O().required(i("validation.required")),notes:O().nullable()}),{handleSubmit:P,errors:h,defineField:q,setFieldValue:I}=gt({validationSchema:z,initialValues:{location:"",notes:""}}),[g]=q("location"),[b]=q("notes"),{data:Q,pending:Xt,refresh:F}=([d,r]=ot(()=>xt("/orders/get-cart-items")),d=await d,r(),d);st(()=>{F()}),at(()=>{F()}),nt(Q,t=>{t!=null&&t.data&&(l.value=t.data.map(e=>({id:e.id,machine_id:e.machine_id,name:e.machine_title,category:e.machine_device_class,price:e.quantity>0?e.total_price/e.quantity:0,quantity:e.quantity,image:e.machine_image||"https://picsum.photos/id/1/200/200"})))},{immediate:!0});const R=(t,e)=>{l.value=l.value.map(s=>s.id===t?{...s,quantity:Math.max(1,s.quantity+e)}:s)},{delete:N}=yt(),{upload:U}=_t(),V=async t=>{try{await N(`/orders/remove-from-cart/${t}`),l.value=l.value.filter(e=>e.id!==t),C(i("cart.item_removed_success"))}catch(e){console.error(e),M(i("cart.item_remove_error"))}},H=rt(()=>l.value.reduce((t,e)=>t+e.price*e.quantity,0)),S=()=>{_.value=!1},J=t=>{dt({path:"/profile/product-details",query:{id:t.machine_id||t.id,name:t.name,category:t.category,price:t.price,image:t.image}})},W=()=>{x.value=!0},Y=()=>{x.value=!1},G=({lat:t,lng:e,address:s})=>{w.value=t,$.value=e,I("location",s)},A=P(t=>{_.value=!0}),K=async({method:t,callback:e})=>{try{const s=new FormData;s.append("map_desc",g.value||i("cart.default_location")),s.append("lat",w.value.toString()),s.append("lng",$.value.toString()),s.append("pay_type",t.key),b.value&&s.append("notes",b.value);const D=await U("/orders/create-cart-order",s);C(`${i("cart.payment_success")} ${(t==null?void 0:t.slug_text)||i("cart.card")}`),l.value=[],S()}catch(s){console.error(s),M(i("cart.payment_error"))}finally{e()}};return(t,e)=>{const s=Bt,D=ht,X=ft;return m(),p("main",Et,[o("div",Ot,[o("div",Tt,[o("div",zt,[(m(!0),p(it,null,lt(l.value,u=>(m(),ct(s,{key:u.id,item:u,onUpdateQuantity:R,onRemove:V,onClick:J},null,8,["item"]))),128)),l.value.length===0?(m(),p("div",Pt,[o("p",It,c(t.$t("cart.empty")),1)])):y("",!0)]),l.value.length>0?(m(),p("div",Qt,[o("div",Rt,[o("label",Nt,c(t.$t("cart.device_location")),1),o("div",Ut,[j(o("input",{"onUpdate:modelValue":e[0]||(e[0]=u=>E(g)?g.value=u:null),placeholder:t.$t("cart.device_location"),type:"text",class:B(["w-full bg-[#F5EBE0]/50 border border-white/50 rounded-xl py-3 px-4 pl-10 text-right focus:outline-none focus:ring-2 focus:ring-primary/50 placeholder:text-gray-400",{"border-red-500":a(h).location}])},null,10,Vt),[[L,a(g)]]),o("button",{onClick:W,type:"button",class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-primary transition-colors"},[o("div",Ht,[f(a(T),{size:"16"})])])]),a(h).location?(m(),p("span",Jt,c(a(h).location),1)):y("",!0)]),o("div",Wt,[o("label",Yt,c(t.$t("cart.notes")),1),j(o("textarea",{"onUpdate:modelValue":e[1]||(e[1]=u=>E(b)?b.value=u:null),rows:"4",placeholder:t.$t("cart.notes"),class:B(["w-full bg-[#F5EBE0]/50 border border-white/50 rounded-xl py-3 px-4 text-right focus:outline-none focus:ring-2 focus:ring-primary/50 placeholder:text-gray-400 resize-none",{"border-red-500":a(h).notes}])},null,10,Gt),[[L,a(b)]]),a(h).notes?(m(),p("span",Kt,c(a(h).notes),1)):y("",!0)]),o("button",{onClick:e[2]||(e[2]=(...u)=>a(A)&&a(A)(...u)),class:"w-full hover:bg-[#8a320f] text-white font-bold py-3 rounded-xl shadow-lg active:scale-95 transition-all background-btn"},c(t.$t("cart.checkout")),1)])):y("",!0)]),f(D,{isOpen:_.value,total:H.value,type:"store",onClose:S,onSubmit:K},null,8,["isOpen","total"]),f(X,{isOpen:x.value,initialLat:w.value,initialLng:$.value,onClose:Y,onLocationSelected:G},null,8,["isOpen","initialLat","initialLng"])])])}}};export{he as default};
