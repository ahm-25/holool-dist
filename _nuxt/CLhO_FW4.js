import{r as f,g as d,W as ae,n as q,G as se,c as n,o as i,a as s,b as g,J as _,d as oe,t as r,C as P,F as k,B as A,w as le,M as re,S as ne,a2 as ie,R as ce}from"./OI3PzNV2.js";import{_ as de,C as ue,P as me,a as fe}from"./CGAHCu1Z.js";import{_ as ge}from"./B3_awDU6.js";import{b as M}from"./F73BFBEp.js";import"./CpGMb49Z.js";import"./XDG_G50n.js";import"./DwuVNmEu.js";import"./C37uFHYe.js";const pe={class:"min-h-screen pb-20 overflow-x-hidden relative"},ve={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},be={key:0,class:"mt-6 p-4 rounded-2xl bg-red-50/80 border border-red-200 text-red-700"},_e={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6"},he={class:"w-full mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 fade-in"},xe={class:"flex justify-between items-start mb-4"},ye={class:"flex flex-col items-start gap-1"},we={class:"text-[#8b7e77] text-sm"},ke={class:"text-[#5d5551] font-bold text-lg"},Ce={class:"flex items-start gap-3"},$e={class:"flex flex-col items-end"},Ne={class:"font-bold text-[#5d5551] text-lg"},je={class:"flex items-center gap-1 text-[#9ca3af] text-xs mt-0.5"},Pe={class:"w-10 h-10 rounded-lg border border-[#bf4e26]/30 flex items-center justify-center text-[#bf4e26] bg-[#bf4e26]/10"},Ae={class:"flex justify-between items-end mt-2 pt-3 border-t border-[#bf4e26]/10"},Me={class:"flex flex-col gap-1"},Te={class:"text-[#8b7e77] text-sm"},Fe={class:"font-bold text-[#5d5551]"},Ee={class:"flex flex-col gap-2 items-end"},Oe=["onClick"],De=["onClick"],Ie={key:1,class:"col-span-full flex flex-col items-center justify-center py-20 text-[#8b7e77] opacity-60"},Re={class:"text-lg font-medium"},Se={class:"text-center text-gray-800 font-bold text-lg mb-6"},Be={class:"space-y-3 mb-8"},Le=["onClick"],Ue={class:"w-5 h-5 rounded-full border border-gray-300 flex items-center justify-center p-0.5"},Ve={key:0,class:"w-full h-full bg-red-500 rounded-full"},ze={class:"font-medium text-gray-700 text-right flex-1 mr-4"},We={class:"flex flex-col gap-3"},qe=["disabled"],Ge={key:0,class:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"},at={__name:"index",async setup(He){let h,T;const x=f("NEW"),c=f(1),C=d(()=>({NEW:"new",PAYMENT:"waiting_for_pay",CURRENT:"current",FINISHED:"finished"})[x.value]||"new"),G=d(()=>({status:C.value,page:c.value})),H=d(()=>`orders-market-cart-${C.value}-${c.value}`),{data:J,pending:F,error:Y,refresh:E}=([h,T]=ae(()=>M("/orders/market-cart",{query:G,watch:[C,c],server:!1,key:H})),h=await h,T(),h),O=d(()=>{const e=J.value;if(!e||typeof e!="object")return e;const o=e,a=o!=null&&o.data&&typeof o.data=="object"?o.data:o,l=a!=null&&a.data&&typeof a.data=="object"?a.data:a,m=(l==null?void 0:l.pagination)??(a==null?void 0:a.pagination)??(o==null?void 0:o.pagination);return m&&l&&typeof l=="object"&&!Array.isArray(l)&&!l.pagination?{...l,pagination:m}:l}),D=d(()=>{var a;const e=O.value;return Array.isArray(e==null?void 0:e.orders)&&e.orders||Array.isArray((a=e==null?void 0:e.data)==null?void 0:a.orders)&&e.data.orders||Array.isArray(e)&&e||[]}),I=d(()=>{var m,S,B,L,U,V,z,W;const e=O.value,o=w=>{if(!w||typeof w!="string")return null;try{const b=new URL(w).searchParams.get("page"),j=Number(b);return Number.isFinite(j)&&j>0?j:null}catch{const N=w.match(/[?&]page=(\d+)/);if(!N)return null;const b=Number(N[1]);return Number.isFinite(b)&&b>0?b:null}},a=((m=e==null?void 0:e.pagination)==null?void 0:m.total_pages)??((S=e==null?void 0:e.pagination)==null?void 0:S.totalPages)??(e==null?void 0:e.total_pages)??(e==null?void 0:e.last_page)??((B=e==null?void 0:e.meta)==null?void 0:B.last_page)??((L=e==null?void 0:e.pagination)==null?void 0:L.last_page)??((U=e==null?void 0:e.data)==null?void 0:U.last_page)??(e!=null&&e.total&&(e!=null&&e.per_page)?Math.ceil(Number(e.total)/Number(e.per_page)):null)??((V=e==null?void 0:e.pagination)!=null&&V.total_items&&((z=e==null?void 0:e.pagination)!=null&&z.per_page)?Math.ceil(Number(e.pagination.total_items)/Number(e.pagination.per_page)):null)??o(e==null?void 0:e.last_page_url)??o((W=e==null?void 0:e.pagination)==null?void 0:W.next_page_url)??1,l=Number(a);return Number.isFinite(l)&&l>0?l:1}),R=d(()=>Y.value?t("profile.orders.market.loadReceiptsError"):null),K=d(()=>F.value);q(x,()=>{c.value=1}),q([I,F],([e,o])=>{o||(c.value>e&&(c.value=e||1),c.value<1&&(c.value=1))});const Q=e=>{x.value=e},p=f(!1),$=f([]),u=f(null),y=f(null),v=f(null),X=async e=>{var o;if(y.value=e,u.value=null,$.value.length===0)try{const{data:a}=await M("/cancel-reasons");((o=a.value)==null?void 0:o.key)==="success"&&($.value=a.value.data)}catch(a){console.error("Failed to fetch cancel reasons",a)}p.value=!0},Z=async()=>{if(!(!u.value||!y.value||v.value)){v.value=y.value;try{const{data:e}=await M("/orders/cancel-order",{method:"POST",body:{order_id:y.value,cancel_type_reason_id:u.value}});e.value&&(e.value.key==="success"||e.value.status===!0)&&(p.value=!1,E())}catch(e){console.error("Failed to cancel order",e)}finally{v.value=null}}},ee=se(),te=e=>{ce(ee(`/profile/orders/market/receipts/${e}`))};return(e,o)=>(i(),n("div",pe,[s("div",ve,[g(ge,{items:[{label:"الطلبات",to:"/profile/orders",active:!1},{label:e.$t("categories.medicalSales.title"),to:"/profile/orders/market",active:!1},{label:e.$t("profile.orders.menuItems.receipts"),active:!0}]},null,8,["items"]),g(de,{"active-tab":x.value,onChange:Q},null,8,["active-tab"]),R.value?(i(),n("div",be,[oe(r(R.value)+" ",1),s("button",{class:"underline font-semibold ms-2",onClick:o[0]||(o[0]=a=>P(E)())},r(e.$t("cards.maintenanceDetails.retry")),1)])):_("",!0),K.value?(i(),n("div",_e,[(i(),n(k,null,A(6,a=>s("div",{key:a,class:"animate-pulse rounded-2xl bg-white/40 h-[150px]"})),64))])):(i(),n(k,{key:2},[s("div",he,[D.value.length?(i(!0),n(k,{key:0},A(D.value,a=>{var l;return i(),n("div",{key:a.id??a.order_num,class:"group bg-white/40 backdrop-blur-sm border border-white/60 rounded-2xl p-5 shadow-sm hover:shadow-md hover:bg-white/60 transition-all duration-300 flex flex-col justify-between min-h-[140px]"},[s("div",xe,[s("div",ye,[s("span",we,r(e.$t("cards.maintenanceDetails.serviceType"))+" :",1),s("span",ke,r(a.type_text??a.serviceType??"-"),1)]),s("div",Ce,[s("div",$e,[s("span",Ne,r(a.order_num??a.id),1),s("div",je,[g(P(ue),{class:"w-3 h-3"}),s("span",null,r(a.created_at??a.time??""),1)])]),s("div",Pe,[g(P(me),{class:"w-5 h-5"})])])]),s("div",Ae,[s("div",Me,[s("span",Te,r(e.$t("cards.maintenanceDetails.status"))+" :",1),s("span",Fe,r(a.status_text??a.status??""),1)]),s("div",Ee,[s("button",{onClick:m=>te(a.id),class:"text-primary font-bold text-sm hover:underline"},r(e.$t("common.viewOrder")),9,Oe),(l=a.buttons)!=null&&l.cancel?(i(),n("button",{key:0,onClick:m=>X(a.id),class:"text-red-500 font-bold text-xs hover:underline flex items-center gap-1"},r(e.$t("cards.maintenanceDetails.cancelOrder")),9,De)):_("",!0)])])])}),128)):(i(),n("div",Ie,[o[5]||(o[5]=s("div",{class:"w-16 h-16 mb-4 rounded-full border-2 border-dashed border-[#8b7e77] flex items-center justify-center"},[s("span",{class:"text-2xl"},"!")],-1)),s("p",Re,r(e.$t("profile.orders.noOrders")),1)]))]),g(fe,{page:c.value,"onUpdate:page":o[1]||(o[1]=a=>c.value=a),totalPages:I.value},null,8,["page","totalPages"])],64))]),g(ie,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-200 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:le(()=>[p.value?(i(),n("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:o[4]||(o[4]=a=>p.value=!1)},[s("div",{class:"bg-white/90 backdrop-blur-md w-full max-w-lg rounded-3xl p-6 shadow-2xl border border-white/20",onClick:o[3]||(o[3]=ne(()=>{},["stop"]))},[s("h3",Se,r(e.$t("cancelModal.title")),1),s("div",Be,[(i(!0),n(k,null,A($.value,a=>(i(),n("div",{key:a.id,onClick:l=>u.value=a.id,class:re(["flex items-center justify-between p-4 rounded-xl cursor-pointer transition-all border group",u.value===a.id?"bg-red-50 border-red-200 ring-1 ring-red-200":"bg-gray-50 border-transparent hover:bg-gray-100"])},[s("div",Ue,[u.value===a.id?(i(),n("div",Ve)):_("",!0)]),s("span",ze,r(a.name),1)],10,Le))),128))]),s("div",We,[s("button",{onClick:Z,disabled:!u.value||v.value,class:"w-full bg-[#E57373] text-white py-3 rounded-xl font-bold text-lg shadow-lg hover:bg-[#d45d5d] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[v.value?(i(),n("div",Ge)):_("",!0),s("span",null,r(e.$t("cancelModal.confirm")),1)],8,qe),s("button",{onClick:o[2]||(o[2]=a=>p.value=!1),class:"w-full bg-gray-100 text-gray-600 py-3 rounded-xl font-bold text-lg hover:bg-gray-200 transition-colors"},r(e.$t("cancelModal.cancel")),1)])])])):_("",!0)]),_:1})]))}};export{at as default};
