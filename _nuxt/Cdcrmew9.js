import{_ as te,E as ae,G as se,g as le,r as c,k as oe,O as ne,c as n,o as i,b as o,a,S as D,M as g,P as M,aD as U,J as h,t as r,C as s,w as A,T as N,F as z,B as P,d as ie}from"./CfVQ7UYt.js";import{_ as re}from"./j2TnU8dc.js";import{_ as de}from"./CYkIFUSy.js";import{c as ce,h as R,b as x,u as ue,F as w,E as b}from"./CcR_tazT.js";import{a as me,u as pe}from"./DCGxFebN.js";import{u as ve}from"./gV_JJjXA.js";import{C as S}from"./Bq8QAi8J.js";import{M as fe}from"./Biop4szc.js";import{X as T}from"./An3bDAmx.js";import{c as ge}from"./CdZn6wq7.js";import"./CnFysPOj.js";import"./CNZ5aXak.js";import"./CJ0lsQ-3.js";import"./BqimD7Il.js";/**
 * @license lucide-vue-next v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=ge("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),he={class:"container mx-auto px-4 py-6"},be={class:"bg-white/40 backdrop-blur-sm rounded-3xl p-6 md:p-8 shadow-sm max-w-3xl mx-auto"},ye={class:"flex items-center justify-between bg-[#E8DAD6]/50 rounded-xl p-1 mb-8 w-full md:w-fit gap-4 mx-auto md:mx-0"},_e={class:"w-4 h-4 rounded-full border border-current flex items-center justify-center"},xe={key:0,class:"w-2 h-2 rounded-full bg-white"},we={class:"w-4 h-4 rounded-full border border-current flex items-center justify-center"},ke={key:0,class:"w-2 h-2 rounded-full bg-white"},Ie={class:"space-y-2"},$e={class:"block text-gray-700 font-medium"},qe={class:"space-y-2"},je={class:"block text-gray-700 font-medium"},De={class:"relative"},Fe={value:"",disabled:""},Ce=["value"],Le={class:"space-y-2"},Ee={class:"block text-gray-700 font-medium"},Me={class:"relative"},Ue={value:"",disabled:""},Ae=["value"],Ne={class:"space-y-2"},ze={class:"block text-gray-700 font-medium"},Pe={class:"space-y-2"},Re={class:"block text-gray-700 font-medium"},Se={class:"space-y-2"},Te={class:"block text-gray-700 font-medium"},Ve={key:1,class:"relative w-full h-full"},Oe=["src"],Be={key:2,class:"flex flex-col items-center justify-center gap-2 text-gray-500"},Ge={class:"w-12 h-12 rounded-xl border border-gray-400 flex items-center justify-center"},He={key:0,class:"text-sm text-green-600"},Je={class:"space-y-2"},Qe={class:"block text-gray-700 font-medium"},We={key:1,class:"relative w-full h-full"},Xe=["src"],Ke=["src"],Ye={key:2,class:"flex flex-col items-center justify-center gap-2 text-gray-500"},Ze={class:"w-12 h-12 rounded-xl border border-gray-400 flex items-center justify-center"},et={key:0,class:"text-sm text-green-600"},tt={class:"pt-4 flex justify-center"},at=["disabled"],st={key:0,class:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"},lt={__name:"immediate",setup(ot){const{t:d}=ae(),{api:O}=me(),{upload:B}=pe(),F=ve(),G=se(),H=le(()=>[{label:d("navigation.home"),to:"/"},{label:d("sections.medicalMaintenance.title"),to:"/profile/sections/maintaince"},{label:d("cards.instantMaintenance.title"),active:!0}]),u=c("quote"),I=c([]),$=c([]),C=c(!0),y=c(!1),L=c(null),q=c(!1),j=c({lat:null,lng:null}),v=c(null),m=c({url:null,type:null});oe(async()=>{var t;C.value=!0,L.value=null;try{const e=await O("/device-models-and-facilities",{method:"GET"});console.log("API Response:",e),e&&e.key==="success"&&e.data?(I.value=e.data.device_models||[],$.value=e.data.facilities||[]):(console.warn("Unexpected API response structure:",e),(t=e==null?void 0:e.data)!=null&&t.device_models&&(I.value=e.data.device_models,$.value=e.data.facilities))}catch(e){console.error("Failed to fetch models and facilities:",e),L.value=e.message||"Failed to load data"}finally{C.value=!1}});const J=ce({serialNumber:x().required(d("validation.required")),model:x().required(d("validation.required")),department:x().required(d("validation.required")),location:x().required(d("validation.required")),description:x().required(d("validation.required")),deviceImage:R().required(d("validation.required")),faultImage:R().required(d("validation.required"))}),{handleSubmit:Q,errors:f,setFieldValue:_,values:k}=ue({validationSchema:J,initialValues:{serialNumber:"",model:"",department:"",location:"",description:"",deviceImage:null,faultImage:null}}),W=(t,e)=>{const l=t.target.files[0];l&&(e("deviceImage",l),v.value=URL.createObjectURL(l))},X=t=>{t("deviceImage",null),v.value&&(URL.revokeObjectURL(v.value),v.value=null)},K=(t,e)=>{const l=t.target.files[0];if(l){e("faultImage",l);const p=URL.createObjectURL(l),ee=l.type.startsWith("video")?"video":"image";m.value={url:p,type:ee}}},Y=t=>{t("faultImage",null),m.value.url&&(URL.revokeObjectURL(m.value.url),m.value={url:null,type:null})},Z=t=>{_("location",t.address),j.value={lat:t.lat,lng:t.lng}},E=Q(async t=>{y.value=!0;try{const e=new FormData;e.append("device_no",t.serialNumber),e.append("device_model_id",t.model),e.append("facility_id",t.department),e.append("map_desc",t.location),e.append("lat",j.value.lat||""),e.append("lng",j.value.lng||""),e.append("notes",t.description),t.deviceImage&&e.append("image",t.deviceImage),t.faultImage&&e.append("image_damage[]",t.faultImage),e.append("price_policy",u.value==="quote"?"offers":"admin");const l=await B("/orders/immediate/create-order",e);if(l&&(l.key==="success"||l.status===!0))F.success(d("maintenance.immediate.successMessage")),ne(G("/profile/orders"));else throw new Error(l.msg||"Failed to submit")}catch(e){console.error("Submission error:",e),F.error(e.error||e.message||d("common.sendError"))}finally{y.value=!1}});return(t,e)=>(i(),n("div",he,[o(re,{items:H.value},null,8,["items"]),a("div",be,[a("form",{onSubmit:e[7]||(e[7]=D((...l)=>s(E)&&s(E)(...l),["prevent"])),class:"space-y-6"},[a("div",ye,[a("label",{class:g(["flex items-center gap-2 cursor-pointer px-4 py-2 rounded-lg transition-all",u.value==="quote"?"bg-[#AC4520] text-white shadow-sm":"text-gray-600"])},[M(a("input",{type:"radio",name:"requestType",value:"quote","onUpdate:modelValue":e[0]||(e[0]=l=>u.value=l),class:"hidden"},null,512),[[U,u.value]]),a("span",_e,[u.value==="quote"?(i(),n("span",xe)):h("",!0)]),a("span",null,r(t.$t("maintenance.immediate.priceQuote")),1)],2),a("label",{class:g(["flex items-center gap-2 cursor-pointer px-4 py-2 rounded-lg transition-all",u.value==="management"?"bg-[#AC4520] text-white shadow-sm":"text-gray-600"])},[M(a("input",{type:"radio",name:"requestType",value:"management","onUpdate:modelValue":e[1]||(e[1]=l=>u.value=l),class:"hidden"},null,512),[[U,u.value]]),a("span",we,[u.value==="management"?(i(),n("span",ke)):h("",!0)]),a("span",null,r(t.$t("maintenance.immediate.managementPrice")),1)],2)]),a("div",Ie,[a("label",$e,r(t.$t("maintenance.immediate.serialNumber")),1),o(s(w),{name:"serialNumber",type:"text",placeholder:t.$t("maintenance.immediate.serialNumber"),class:g(["main-input",{"main-input-error":s(f).serialNumber}])},null,8,["placeholder","class"]),o(s(b),{name:"serialNumber",class:"text-red-500 text-sm"})]),a("div",qe,[a("label",je,r(t.$t("maintenance.immediate.model")),1),a("div",De,[o(s(w),{name:"model"},{default:A(({field:l})=>[a("select",N(l,{class:["w-full h-14 px-4 bg-[#e8dad6]/80 rounded-2xl appearance-none outline-none text-gray-700 focus:ring-2 focus:ring-[#a64218]/30 transition-all",{"border border-red-500":s(f).model}]}),[a("option",Fe,r(t.$t("maintenance.immediate.model")),1),(i(!0),n(z,null,P(I.value,p=>(i(),n("option",{key:p.id,value:p.id},r(p.name),9,Ce))),128))],16)]),_:1}),o(s(S),{class:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none",size:"20"})]),o(s(b),{name:"model",class:"text-red-500 text-sm"})]),a("div",Le,[a("label",Ee,r(t.$t("maintenance.immediate.department")),1),a("div",Me,[o(s(w),{name:"department"},{default:A(({field:l})=>[a("select",N(l,{class:["w-full h-14 px-4 bg-[#e8dad6]/80 rounded-2xl appearance-none outline-none text-gray-700 focus:ring-2 focus:ring-[#a64218]/30 transition-all",{"border border-red-500":s(f).department}]}),[a("option",Ue,r(t.$t("maintenance.immediate.department")),1),(i(!0),n(z,null,P($.value,p=>(i(),n("option",{key:p.id,value:p.id},r(p.name),9,Ae))),128))],16)]),_:1}),o(s(S),{class:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none",size:"20"})]),o(s(b),{name:"department",class:"text-red-500 text-sm"})]),a("div",Ne,[a("label",ze,r(t.$t("maintenance.immediate.deviceLocation")),1),a("div",{class:"relative cursor-pointer",onClick:e[2]||(e[2]=l=>q.value=!0)},[o(s(w),{name:"location",type:"text",placeholder:t.$t("maintenance.immediate.deviceLocation"),class:g(["main-input pl-12 cursor-pointer",{"main-input-error":s(f).location}]),readonly:""},null,8,["placeholder","class"]),o(s(fe),{class:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400",size:"20"})]),o(s(b),{name:"location",class:"text-red-500 text-sm"})]),a("div",Pe,[a("label",Re,r(t.$t("maintenance.immediate.faultDescription")),1),o(s(w),{name:"description",as:"textarea",placeholder:t.$t("maintenance.immediate.faultDescription"),class:g(["main-textarea h-32 py-3",{"main-input-error":s(f).description}])},null,8,["placeholder","class"]),o(s(b),{name:"description",class:"text-red-500 text-sm"})]),a("div",Se,[a("label",Te,r(t.$t("maintenance.immediate.attachDeviceImage")),1),a("div",{class:g(["group border-2 border-dashed border-gray-300 rounded-2xl p-4 md:p-8 bg-[#E8DAD6]/30 text-center cursor-pointer hover:bg-[#E8DAD6]/50 transition-colors relative h-48 flex items-center justify-center overflow-hidden",{"border-red-500":s(f).deviceImage}])},[v.value?h("",!0):(i(),n("input",{key:0,type:"file",accept:"image/*",class:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10",onChange:e[3]||(e[3]=l=>W(l,s(_)))},null,32)),v.value?(i(),n("div",Ve,[a("img",{src:v.value,class:"w-full h-full object-cover rounded-xl shadow-sm"},null,8,Oe),a("button",{type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white p-1.5 rounded-full shadow-lg hover:bg-red-600 transition-colors z-20",onClick:e[4]||(e[4]=D(l=>X(s(_)),["stop"]))},[o(s(T),{class:"w-4 h-4"})])])):(i(),n("div",Be,[a("div",Ge,[o(s(V),{class:"text-gray-500",size:"24"})]),s(k).deviceImage?(i(),n("span",He,r(s(k).deviceImage.name),1)):h("",!0)]))],2),o(s(b),{name:"deviceImage",class:"text-red-500 text-sm"})]),a("div",Je,[a("label",Qe,r(t.$t("maintenance.immediate.faultImaging")),1),a("div",{class:g(["group border-2 border-dashed border-gray-300 rounded-2xl p-4 md:p-8 bg-[#E8DAD6]/30 text-center cursor-pointer hover:bg-[#E8DAD6]/50 transition-colors relative h-48 flex items-center justify-center overflow-hidden",{"border-red-500":s(f).faultImage}])},[m.value.url?h("",!0):(i(),n("input",{key:0,type:"file",accept:"image/*,video/*",class:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10",onChange:e[5]||(e[5]=l=>K(l,s(_)))},null,32)),m.value.url?(i(),n("div",We,[m.value.type==="video"?(i(),n("video",{key:0,src:m.value.url,controls:"",class:"w-full h-full object-cover rounded-xl shadow-sm"},null,8,Xe)):(i(),n("img",{key:1,src:m.value.url,class:"w-full h-full object-cover rounded-xl shadow-sm"},null,8,Ke)),a("button",{type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white p-1.5 rounded-full shadow-lg hover:bg-red-600 transition-colors z-20",onClick:e[6]||(e[6]=D(l=>Y(s(_)),["stop"]))},[o(s(T),{class:"w-4 h-4"})])])):(i(),n("div",Ye,[a("div",Ze,[o(s(V),{class:"text-gray-500",size:"24"})]),s(k).faultImage?(i(),n("span",et,r(s(k).faultImage.name),1)):h("",!0)]))],2),o(s(b),{name:"faultImage",class:"text-red-500 text-sm"})]),a("div",tt,[a("button",{type:"submit",class:"bg-[#AC4520] hover:bg-[#8F300E] text-white font-medium py-3 px-12 rounded-xl transition-colors min-w-[200px] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",disabled:y.value},[y.value?(i(),n("div",st)):h("",!0),ie(" "+r(y.value?t.$t("common.sending"):t.$t("maintenance.immediate.send")),1)],8,at)])],32)]),o(de,{"is-open":q.value,onClose:e[8]||(e[8]=l=>q.value=!1),onLocationSelected:Z},null,8,["is-open"])]))}},_t=te(lt,[["__scopeId","data-v-06e2153a"]]);export{_t as default};
