import{_ as me,E as pe,G as ve,g as fe,r as c,k as ge,a0 as be,O as he,c as i,b as o,a,S as M,M as b,P as T,aD as V,J as h,t as n,C as l,w as P,T as B,F as G,B as H,d as J,o as r}from"./DtlkFUv2.js";import{_ as ye}from"./GzQTdmL6.js";import{_ as xe}from"./zXQksO3E.js";import{D as _e}from"./FJ4yhVG2.js";import{_ as we}from"./Dq_SzVEy.js";import{c as ke,h as Q,b as k,u as $e,F as $,E as y}from"./BaUCWVHf.js";import{a as Ie,u as qe}from"./BcraiT0z.js";import{u as je}from"./qIaXEmvY.js";import{C as W}from"./Dg_5oGkL.js";import{M as De}from"./bnpOryCG.js";import{X}from"./BdjwzSQR.js";import{c as Ce}from"./B8u25cvq.js";import"./CbXOsLjH.js";import"./B6LoSh53.js";import"./DAYFLVbi.js";import"./abdh5Lal.js";import"./fDhdjmhs.js";import"./CY06FC8a.js";/**
 * @license lucide-vue-next v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=Ce("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),Fe=""+new URL("coins.Bb6Omikv.png",import.meta.url).href,Le={class:"container mx-auto px-4 py-6"},Ue={class:"bg-white/40 backdrop-blur-sm rounded-3xl p-6 md:p-8 shadow-sm max-w-3xl mx-auto"},Ae={class:"flex items-center justify-between bg-[#E8DAD6]/50 rounded-xl p-1 mb-8 w-full md:w-fit gap-4 mx-auto md:mx-0"},Ee={class:"w-4 h-4 rounded-full border border-current flex items-center justify-center"},Me={key:0,class:"w-2 h-2 rounded-full bg-white"},Pe={class:"w-4 h-4 rounded-full border border-current flex items-center justify-center"},Re={key:0,class:"w-2 h-2 rounded-full bg-white"},Oe={class:"space-y-2"},Se={class:"block text-gray-700 font-medium"},Ne={class:"space-y-2"},ze={class:"block text-gray-700 font-medium"},Te={class:"relative"},Ve={value:"",disabled:""},Be=["value"],Ge={class:"space-y-2"},He={class:"block text-gray-700 font-medium"},Je={class:"relative"},Qe={value:"",disabled:""},We=["value"],Xe={class:"space-y-2"},Ke={class:"block text-gray-700 font-medium"},Ye={class:"space-y-2"},Ze={class:"block text-gray-700 font-medium"},et={class:"space-y-2"},tt={class:"block text-gray-700 font-medium"},at={key:1,class:"relative w-full h-full"},st=["src"],lt={key:2,class:"flex flex-col items-center justify-center gap-2 text-gray-500"},ot={class:"w-12 h-12 rounded-xl border border-gray-400 flex items-center justify-center"},nt={key:0,class:"text-sm text-green-600"},it={class:"space-y-2"},rt={class:"block text-gray-700 font-medium"},dt={key:1,class:"relative w-full h-full"},ct=["src"],ut=["src"],mt={key:2,class:"flex flex-col items-center justify-center gap-2 text-gray-500"},pt={class:"w-12 h-12 rounded-xl border border-gray-400 flex items-center justify-center"},vt={key:0,class:"text-sm text-green-600"},ft={class:"pt-4 flex justify-center"},gt=["disabled"],bt={key:0,class:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"},ht={class:"flex flex-col items-center gap-4 py-4"},yt={class:"text-center"},xt={class:"text-3xl font-bold text-[#AC4520] mb-2 dir-rtl"},_t={class:"text-gray-600 font-medium text-lg"},wt={class:"flex gap-4 w-full mt-4"},kt={__name:"immediate",setup($t){const{t:u}=pe(),{api:R}=Ie(),{upload:Y}=qe(),F=je(),Z=ve(),ee=fe(()=>[{label:u("navigation.home"),to:"/"},{label:u("sections.medicalMaintenance.title"),to:"/profile/sections/maintaince"},{label:u("cards.instantMaintenance.title"),active:!0}]),p=c("quote"),L=c([]),U=c([]),O=c(!0),f=c(!1),S=c(null),I=c(!1),q=c({lat:null,lng:null}),v=c(null),m=c({url:null,type:null}),x=c(!1),_=c(!1),j=c(0),D=c(null);ge(async()=>{var e;O.value=!0,S.value=null;try{const t=await R("/device-models-and-facilities",{method:"GET"});console.log("API Response:",t),t&&t.key==="success"&&t.data?(L.value=t.data.device_models||[],U.value=t.data.facilities||[]):(console.warn("Unexpected API response structure:",t),(e=t==null?void 0:t.data)!=null&&e.device_models&&(L.value=t.data.device_models,U.value=t.data.facilities))}catch(t){console.error("Failed to fetch models and facilities:",t),S.value=t.message||"Failed to load data"}finally{O.value=!1}});const te=ke({serialNumber:k().required(u("validation.required")),model:k().required(u("validation.required")),department:k().required(u("validation.required")),location:k().required(u("validation.required")),description:k().required(u("validation.required")),deviceImage:Q().required(u("validation.required")),faultImage:Q().required(u("validation.required"))}),{handleSubmit:ae,errors:g,setFieldValue:w,values:C,resetForm:se}=$e({validationSchema:te,initialValues:{serialNumber:"",model:"",department:"",location:"",description:"",deviceImage:null,faultImage:null}});be(()=>{se(),p.value="quote",I.value=!1,q.value={lat:null,lng:null},x.value=!1,_.value=!1,j.value=0,D.value=null,v.value&&(URL.revokeObjectURL(v.value),v.value=null),m.value.url&&(URL.revokeObjectURL(m.value.url),m.value={url:null,type:null})});const le=(e,t)=>{const s=e.target.files[0];s&&(t("deviceImage",s),v.value=URL.createObjectURL(s))},oe=e=>{e("deviceImage",null),v.value&&(URL.revokeObjectURL(v.value),v.value=null)},ne=(e,t)=>{const s=e.target.files[0];if(s){t("faultImage",s);const d=URL.createObjectURL(s),A=s.type.startsWith("video")?"video":"image";m.value={url:d,type:A}}},ie=e=>{e("faultImage",null),m.value.url&&(URL.revokeObjectURL(m.value.url),m.value={url:null,type:null})},re=e=>{w("location",e.address),q.value={lat:e.lat,lng:e.lng}},de=async()=>{try{const e=await R("/advertisement-price",{method:"GET"});return e&&e.key==="success"?e.data:0}catch(e){return console.error("Failed to fetch price:",e),0}},N=ae(async e=>{if(f.value=!0,p.value==="management"){try{const t=await de();j.value=t,D.value=e,x.value=!0}catch{F.error(u("common.error"))}finally{f.value=!1}return}await z(e)}),ce=()=>{x.value=!1,_.value=!0},ue=async({method:e,callback:t})=>{D.value&&(await z(D.value,{admin_action:"accept",pay_type:e==null?void 0:e.key}),t&&t(),_.value=!1)},z=async(e,t={})=>{f.value=!0;try{const s=new FormData;s.append("device_no",e.serialNumber),s.append("device_model_id",e.model),s.append("facility_id",e.department),s.append("map_desc",e.location),s.append("lat",q.value.lat||""),s.append("lng",q.value.lng||""),s.append("notes",e.description),e.deviceImage&&s.append("image",e.deviceImage),e.faultImage&&s.append("image_damage[]",e.faultImage),s.append("price_policy",p.value==="quote"?"offers":"admin"),Object.entries(t).forEach(([A,E])=>{E!=null&&s.append(A,E)});const d=await Y("/orders/immediate/create-order",s);if(d&&(d.key==="success"||d.status===!0))F.success(u("maintenance.immediate.successMessage")),he(Z("/profile/orders"));else throw new Error(d.msg||"Failed to submit")}catch(s){console.error("Submission error:",s),F.error(s.error||s.message||u("common.sendError"))}finally{f.value=!1}};return(e,t)=>(r(),i("div",Le,[o(ye,{items:ee.value},null,8,["items"]),a("div",Ue,[a("form",{onSubmit:t[7]||(t[7]=M((...s)=>l(N)&&l(N)(...s),["prevent"])),class:"space-y-6"},[a("div",Ae,[a("label",{class:b(["flex items-center gap-2 cursor-pointer px-4 py-2 rounded-lg transition-all",p.value==="quote"?"bg-[#AC4520] text-white shadow-sm":"text-gray-600"])},[T(a("input",{type:"radio",name:"requestType",value:"quote","onUpdate:modelValue":t[0]||(t[0]=s=>p.value=s),class:"hidden"},null,512),[[V,p.value]]),a("span",Ee,[p.value==="quote"?(r(),i("span",Me)):h("",!0)]),a("span",null,n(e.$t("maintenance.immediate.priceQuote")),1)],2),a("label",{class:b(["flex items-center gap-2 cursor-pointer px-4 py-2 rounded-lg transition-all",p.value==="management"?"bg-[#AC4520] text-white shadow-sm":"text-gray-600"])},[T(a("input",{type:"radio",name:"requestType",value:"management","onUpdate:modelValue":t[1]||(t[1]=s=>p.value=s),class:"hidden"},null,512),[[V,p.value]]),a("span",Pe,[p.value==="management"?(r(),i("span",Re)):h("",!0)]),a("span",null,n(e.$t("maintenance.immediate.managementPrice")),1)],2)]),a("div",Oe,[a("label",Se,n(e.$t("maintenance.immediate.serialNumber")),1),o(l($),{name:"serialNumber",type:"text",placeholder:e.$t("maintenance.immediate.serialNumber"),class:b(["main-input",{"main-input-error":l(g).serialNumber}])},null,8,["placeholder","class"]),o(l(y),{name:"serialNumber",class:"text-red-500 text-sm"})]),a("div",Ne,[a("label",ze,n(e.$t("maintenance.immediate.model")),1),a("div",Te,[o(l($),{name:"model"},{default:P(({field:s})=>[a("select",B(s,{class:["w-full h-14 px-4 bg-[#e8dad6]/80 rounded-2xl appearance-none outline-none text-gray-700 focus:ring-2 focus:ring-[#a64218]/30 transition-all",{"border border-red-500":l(g).model}]}),[a("option",Ve,n(e.$t("maintenance.immediate.model")),1),(r(!0),i(G,null,H(L.value,d=>(r(),i("option",{key:d.id,value:d.id},n(d.name),9,Be))),128))],16)]),_:1}),o(l(W),{class:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none",size:"20"})]),o(l(y),{name:"model",class:"text-red-500 text-sm"})]),a("div",Ge,[a("label",He,n(e.$t("maintenance.immediate.department")),1),a("div",Je,[o(l($),{name:"department"},{default:P(({field:s})=>[a("select",B(s,{class:["w-full h-14 px-4 bg-[#e8dad6]/80 rounded-2xl appearance-none outline-none text-gray-700 focus:ring-2 focus:ring-[#a64218]/30 transition-all",{"border border-red-500":l(g).department}]}),[a("option",Qe,n(e.$t("maintenance.immediate.department")),1),(r(!0),i(G,null,H(U.value,d=>(r(),i("option",{key:d.id,value:d.id},n(d.name),9,We))),128))],16)]),_:1}),o(l(W),{class:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none",size:"20"})]),o(l(y),{name:"department",class:"text-red-500 text-sm"})]),a("div",Xe,[a("label",Ke,n(e.$t("maintenance.immediate.deviceLocation")),1),a("div",{class:"relative cursor-pointer",onClick:t[2]||(t[2]=s=>I.value=!0)},[o(l($),{name:"location",type:"text",placeholder:e.$t("maintenance.immediate.deviceLocation"),class:b(["main-input pl-12 cursor-pointer",{"main-input-error":l(g).location}]),readonly:""},null,8,["placeholder","class"]),o(l(De),{class:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400",size:"20"})]),o(l(y),{name:"location",class:"text-red-500 text-sm"})]),a("div",Ye,[a("label",Ze,n(e.$t("maintenance.immediate.faultDescription")),1),o(l($),{name:"description",as:"textarea",placeholder:e.$t("maintenance.immediate.faultDescription"),class:b(["main-textarea h-32 py-3",{"main-input-error":l(g).description}])},null,8,["placeholder","class"]),o(l(y),{name:"description",class:"text-red-500 text-sm"})]),a("div",et,[a("label",tt,n(e.$t("maintenance.immediate.attachDeviceImage")),1),a("div",{class:b(["group border-2 border-dashed border-gray-300 rounded-2xl p-4 md:p-8 bg-[#E8DAD6]/30 text-center cursor-pointer hover:bg-[#E8DAD6]/50 transition-colors relative h-48 flex items-center justify-center overflow-hidden",{"border-red-500":l(g).deviceImage}])},[v.value?h("",!0):(r(),i("input",{key:0,type:"file",accept:"image/*",class:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10",onChange:t[3]||(t[3]=s=>le(s,l(w)))},null,32)),v.value?(r(),i("div",at,[a("img",{src:v.value,class:"w-full h-full object-cover rounded-xl shadow-sm"},null,8,st),a("button",{type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white p-1.5 rounded-full shadow-lg hover:bg-red-600 transition-colors z-20",onClick:t[4]||(t[4]=M(s=>oe(l(w)),["stop"]))},[o(l(X),{class:"w-4 h-4"})])])):(r(),i("div",lt,[a("div",ot,[o(l(K),{class:"text-gray-500",size:"24"})]),l(C).deviceImage?(r(),i("span",nt,n(l(C).deviceImage.name),1)):h("",!0)]))],2),o(l(y),{name:"deviceImage",class:"text-red-500 text-sm"})]),a("div",it,[a("label",rt,n(e.$t("maintenance.immediate.faultImaging")),1),a("div",{class:b(["group border-2 border-dashed border-gray-300 rounded-2xl p-4 md:p-8 bg-[#E8DAD6]/30 text-center cursor-pointer hover:bg-[#E8DAD6]/50 transition-colors relative h-48 flex items-center justify-center overflow-hidden",{"border-red-500":l(g).faultImage}])},[m.value.url?h("",!0):(r(),i("input",{key:0,type:"file",accept:"image/*,video/*",class:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10",onChange:t[5]||(t[5]=s=>ne(s,l(w)))},null,32)),m.value.url?(r(),i("div",dt,[m.value.type==="video"?(r(),i("video",{key:0,src:m.value.url,controls:"",class:"w-full h-full object-cover rounded-xl shadow-sm"},null,8,ct)):(r(),i("img",{key:1,src:m.value.url,class:"w-full h-full object-cover rounded-xl shadow-sm"},null,8,ut)),a("button",{type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white p-1.5 rounded-full shadow-lg hover:bg-red-600 transition-colors z-20",onClick:t[6]||(t[6]=M(s=>ie(l(w)),["stop"]))},[o(l(X),{class:"w-4 h-4"})])])):(r(),i("div",mt,[a("div",pt,[o(l(K),{class:"text-gray-500",size:"24"})]),l(C).faultImage?(r(),i("span",vt,n(l(C).faultImage.name),1)):h("",!0)]))],2),o(l(y),{name:"faultImage",class:"text-red-500 text-sm"})]),a("div",ft,[a("button",{type:"submit",class:"bg-[#AC4520] hover:bg-[#8F300E] text-white font-medium py-3 px-12 rounded-xl transition-colors min-w-[200px] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",disabled:f.value},[f.value?(r(),i("div",bt)):h("",!0),J(" "+n(f.value?e.$t("common.sending"):e.$t("maintenance.immediate.send")),1)],8,gt)])],32)]),o(xe,{"is-open":I.value,onClose:t[8]||(t[8]=s=>I.value=!1),onLocationSelected:re},null,8,["is-open"]),o(_e,{visible:x.value,onClose:t[10]||(t[10]=s=>x.value=!1),width:"400px"},{default:P(()=>[a("div",ht,[t[13]||(t[13]=a("div",{class:"w-20 h-20 relative"},[a("img",{src:Fe,alt:"coins"})],-1)),a("div",yt,[a("div",xt,[J(n(j.value)+" ",1),t[12]||(t[12]=a("span",{class:"text-lg"},"SR",-1))]),a("p",_t,n(e.$t("maintenance.immediate.costFromAdmin")),1)]),a("div",wt,[a("button",{onClick:t[9]||(t[9]=s=>x.value=!1),class:"flex-1 py-3 px-6 rounded-xl border border-red-500 text-red-500 hover:bg-red-50 transition-colors font-medium"},n(e.$t("maintenance.immediate.reject")),1),a("button",{onClick:ce,class:"flex-1 py-3 px-6 rounded-xl bg-[#AC4520] text-white hover:bg-[#8F300E] transition-colors font-medium"},n(e.$t("maintenance.immediate.agree")),1)])])]),_:1},8,["visible"]),o(we,{isOpen:_.value,total:j.value,title:e.$t("cards.maintenanceDetails.paymentModal.title"),onClose:t[11]||(t[11]=s=>_.value=!1),onSubmit:ue},null,8,["isOpen","total","title"])]))}},Vt=me(kt,[["__scopeId","data-v-e2d30660"]]);export{Vt as default};
