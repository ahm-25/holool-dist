import{r as m,g as u,a4 as se,W as oe,n as F,G as re,c as n,o as i,a as s,b as g,J as y,C as b,d as le,t as l,F as N,B as E,w as ne,M as ie,S as ce,a2 as de,R as ue}from"./B5HeACpe.js";import{_ as fe,C as me,P as ge,a as be}from"./Bts07Yfi.js";import{_ as pe}from"./DiY3edDc.js";import{b as O}from"./CEwE9Az9.js";import"./BB7hngxF.js";import"./CGfWc8dA.js";import"./aSvSgRgq.js";import"./P9Gc60wC.js";const ve={class:"min-h-screen pb-20 overflow-x-hidden relative"},_e={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},he={key:0,class:"mt-6 p-4 rounded-2xl bg-red-50/80 border border-red-200 text-red-700"},ye={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6"},xe={class:"w-full mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 fade-in"},we={class:"flex justify-between items-start mb-4"},ke={class:"flex flex-col items-start gap-1"},Ce={class:"text-[#8b7e77] text-sm"},$e={class:"text-[#5d5551] font-bold text-lg"},Ne={class:"flex items-start gap-3"},je={class:"flex flex-col items-end"},Pe={class:"font-bold text-[#5d5551] text-lg"},Ae={class:"flex items-center gap-1 text-[#9ca3af] text-xs mt-0.5"},Me={class:"w-10 h-10 rounded-lg border border-[#bf4e26]/30 flex items-center justify-center text-[#bf4e26] bg-[#bf4e26]/10"},Te={class:"flex justify-between items-end mt-2 pt-3 border-t border-[#bf4e26]/10"},qe={class:"flex flex-col gap-1"},Fe={class:"text-[#8b7e77] text-sm"},Ee={class:"font-bold text-[#5d5551]"},Oe={class:"flex flex-col gap-2 items-end"},De=["onClick"],Ie=["onClick"],Re={key:1,class:"col-span-full flex flex-col items-center justify-center py-20 text-[#8b7e77] opacity-60"},Se={class:"text-lg font-medium"},Be={class:"text-center text-gray-800 font-bold text-lg mb-6"},Le={class:"space-y-3 mb-8"},Ue=["onClick"],Ve={class:"w-5 h-5 rounded-full border border-gray-300 flex items-center justify-center p-0.5"},ze={key:0,class:"w-full h-full bg-red-500 rounded-full"},We={class:"font-medium text-gray-700 text-right flex-1 mr-4"},Ge={class:"flex flex-col gap-3"},He=["disabled"],Je={key:0,class:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"},ot={__name:"index",async setup(Qe){let x,D;const w=m("NEW"),c=m(1),j=u(()=>({NEW:"new",PAYMENT:"waiting_for_pay",CURRENT:"current",FINISHED:"finished"})[w.value]||"new"),p=se(),J=u(()=>({status:j.value,page:c.value,tab:p.query.tab||"sent"})),Q=u(()=>`orders-market-offers-${j.value}-${c.value}-${p.query.tab||"sent"}`),{data:Y,pending:I,error:K,refresh:P}=([x,D]=oe(()=>O("/orders/market-offers",{query:J,watch:[j,c],server:!1,key:Q})),x=await x,D(),x),R=u(()=>{const e=Y.value;if(!e||typeof e!="object")return e;const o=e,r=o!=null&&o.data&&typeof o.data=="object"?o.data:o,a=r!=null&&r.data&&typeof r.data=="object"?r.data:r,d=(a==null?void 0:a.pagination)??(r==null?void 0:r.pagination)??(o==null?void 0:o.pagination);return d&&a&&typeof a=="object"&&!Array.isArray(a)&&!a.pagination?{...a,pagination:d}:a}),S=u(()=>{var r;const e=R.value;return Array.isArray(e==null?void 0:e.orders)&&e.orders||Array.isArray((r=e==null?void 0:e.data)==null?void 0:r.orders)&&e.data.orders||Array.isArray(e)&&e||[]}),B=u(()=>{var d,C,U,V,z,W,G,H;const e=R.value,o=$=>{if(!$||typeof $!="string")return null;try{const h=new URL($).searchParams.get("page"),q=Number(h);return Number.isFinite(q)&&q>0?q:null}catch{const T=$.match(/[?&]page=(\d+)/);if(!T)return null;const h=Number(T[1]);return Number.isFinite(h)&&h>0?h:null}},r=((d=e==null?void 0:e.pagination)==null?void 0:d.total_pages)??((C=e==null?void 0:e.pagination)==null?void 0:C.totalPages)??(e==null?void 0:e.total_pages)??(e==null?void 0:e.last_page)??((U=e==null?void 0:e.meta)==null?void 0:U.last_page)??((V=e==null?void 0:e.pagination)==null?void 0:V.last_page)??((z=e==null?void 0:e.data)==null?void 0:z.last_page)??(e!=null&&e.total&&(e!=null&&e.per_page)?Math.ceil(Number(e.total)/Number(e.per_page)):null)??((W=e==null?void 0:e.pagination)!=null&&W.total_items&&((G=e==null?void 0:e.pagination)!=null&&G.per_page)?Math.ceil(Number(e.pagination.total_items)/Number(e.pagination.per_page)):null)??o(e==null?void 0:e.last_page_url)??o((H=e==null?void 0:e.pagination)==null?void 0:H.next_page_url)??1,a=Number(r);return Number.isFinite(a)&&a>0?a:1}),L=u(()=>K.value?t("profile.orders.market.loadQuotesError"):null),X=u(()=>I.value);F(()=>p.query.tab,()=>{P()}),F(w,()=>{c.value=1}),F([B,I],([e,o])=>{o||(c.value>e&&(c.value=e||1),c.value<1&&(c.value=1))});const Z=e=>{w.value=e},v=m(!1),A=m([]),f=m(null),k=m(null),_=m(null),ee=async e=>{var o;if(k.value=e,f.value=null,A.value.length===0)try{const{data:r}=await O("/cancel-reasons");((o=r.value)==null?void 0:o.key)==="success"&&(A.value=r.value.data)}catch(r){console.error("Failed to fetch cancel reasons",r)}v.value=!0},te=async()=>{if(!(!f.value||!k.value||_.value)){_.value=k.value;try{const{data:e}=await O("/orders/cancel-order",{method:"POST",body:{order_id:k.value,cancel_type_reason_id:f.value}});e.value&&(e.value.key==="success"||e.value.status===!0)&&(v.value=!1,P())}catch(e){console.error("Failed to cancel order",e)}finally{_.value=null}}},ae=e=>{ue(M({path:`/profile/orders/market/quotes/${e}`,query:{tab:p.query.tab||"sent"}}))},M=re();return(e,o)=>{var r;return i(),n("div",ve,[s("div",_e,[g(pe,{items:[{label:"الطلبات",to:b(M)("/profile/orders"),active:!1},{label:e.$t("categories.medicalSales.title"),to:b(M)({path:"/profile/orders/market",query:{tab:((r=b(p).query)==null?void 0:r.tab)||"sent"}}),active:!1},{label:e.$t("profile.orders.menuItems.quotes"),active:!0}]},null,8,["items"]),g(fe,{"active-tab":w.value,onChange:Z},null,8,["active-tab"]),L.value?(i(),n("div",he,[le(l(L.value)+" ",1),s("button",{class:"underline font-semibold ms-2",onClick:o[0]||(o[0]=a=>b(P)())},l(e.$t("cards.maintenanceDetails.retry")),1)])):y("",!0),X.value?(i(),n("div",ye,[(i(),n(N,null,E(6,a=>s("div",{key:a,class:"animate-pulse rounded-2xl bg-white/40 h-[150px]"})),64))])):(i(),n(N,{key:2},[s("div",xe,[S.value.length?(i(!0),n(N,{key:0},E(S.value,a=>{var d;return i(),n("div",{key:a.id??a.order_num,class:"group bg-white/40 backdrop-blur-sm border border-white/60 rounded-2xl p-5 shadow-sm hover:shadow-md hover:bg-white/60 transition-all duration-300 flex flex-col justify-between min-h-[140px]"},[s("div",we,[s("div",ke,[s("span",Ce,l(e.$t("cards.maintenanceDetails.serviceType"))+" :",1),s("span",$e,l(a.type_text??a.serviceType??"-"),1)]),s("div",Ne,[s("div",je,[s("span",Pe,l(a.order_num??a.id),1),s("div",Ae,[g(b(me),{class:"w-3 h-3"}),s("span",null,l(a.created_at??a.time??""),1)])]),s("div",Me,[g(b(ge),{class:"w-5 h-5"})])])]),s("div",Te,[s("div",qe,[s("span",Fe,l(e.$t("cards.maintenanceDetails.status"))+" :",1),s("span",Ee,l(a.status_text??a.status??""),1)]),s("div",Oe,[s("button",{onClick:C=>ae(a.id),class:"text-primary font-bold text-sm hover:underline"},l(e.$t("common.viewOrder")),9,De),(d=a.buttons)!=null&&d.cancel?(i(),n("button",{key:0,onClick:C=>ee(a.id),class:"text-red-500 font-bold text-xs hover:underline flex items-center gap-1"},l(e.$t("cards.maintenanceDetails.cancelOrder")),9,Ie)):y("",!0)])])])}),128)):(i(),n("div",Re,[o[5]||(o[5]=s("div",{class:"w-16 h-16 mb-4 rounded-full border-2 border-dashed border-[#8b7e77] flex items-center justify-center"},[s("span",{class:"text-2xl"},"!")],-1)),s("p",Se,l(e.$t("profile.orders.noOrders")),1)]))]),g(be,{page:c.value,"onUpdate:page":o[1]||(o[1]=a=>c.value=a),totalPages:B.value},null,8,["page","totalPages"])],64))]),g(de,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-200 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:ne(()=>[v.value?(i(),n("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:o[4]||(o[4]=a=>v.value=!1)},[s("div",{class:"bg-white/90 backdrop-blur-md w-full max-w-lg rounded-3xl p-6 shadow-2xl border border-white/20",onClick:o[3]||(o[3]=ce(()=>{},["stop"]))},[s("h3",Be,l(e.$t("cancelModal.title")),1),s("div",Le,[(i(!0),n(N,null,E(A.value,a=>(i(),n("div",{key:a.id,onClick:d=>f.value=a.id,class:ie(["flex items-center justify-between p-4 rounded-xl cursor-pointer transition-all border group",f.value===a.id?"bg-red-50 border-red-200 ring-1 ring-red-200":"bg-gray-50 border-transparent hover:bg-gray-100"])},[s("div",Ve,[f.value===a.id?(i(),n("div",ze)):y("",!0)]),s("span",We,l(a.name),1)],10,Ue))),128))]),s("div",Ge,[s("button",{onClick:te,disabled:!f.value||_.value,class:"w-full bg-[#E57373] text-white py-3 rounded-xl font-bold text-lg shadow-lg hover:bg-[#d45d5d] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[_.value?(i(),n("div",Je)):y("",!0),s("span",null,l(e.$t("cancelModal.confirm")),1)],8,He),s("button",{onClick:o[2]||(o[2]=a=>v.value=!1),class:"w-full bg-gray-100 text-gray-600 py-3 rounded-xl font-bold text-lg hover:bg-gray-200 transition-colors"},l(e.$t("cancelModal.cancel")),1)])])])):y("",!0)]),_:1})])}}};export{ot as default};
