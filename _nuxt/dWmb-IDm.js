import{_ as de}from"./BlwJ1uXT.js";import{_ as ne,a4 as ce,E as pe,g as O,r as x,G as ue,W as ve,n as me,R as he,c as n,o as c,a as t,J as G,b as o,C as s,M as D,t as d,w as v,T as h,F as L,B as S,S as fe}from"./BYEf0NBg.js";import{c as be,f as ge,b as y,g as E,u as _e,F as p,E as u}from"./CbWQZxt2.js";import{_ as xe}from"./JxVkkAUH.js";import{a as ye,u as we,b as $e}from"./Csww0FSG.js";import{u as Ee}from"./SR-Rvwwp.js";import{T as Ce}from"./Dvf_TnAP.js";import{X as ke}from"./BNF5Q_1j.js";import{P as qe}from"./BUBDP9AF.js";import{c as Ae}from"./cSiaAbyi.js";import{M as De}from"./C9Mv1BY4.js";import{C as Fe}from"./Co_PEXwa.js";import"./BIzi2wWj.js";import"./D2tlbMjF.js";import"./WbP1RNmY.js";/**
 * @license lucide-vue-next v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=Ae("cloud-upload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]),Ne={class:"min-h-screen w-full relative overflow-hidden p-6 sm:p-10"},Le={class:"w-full max-w-2xl mx-auto mb-6"},Se={key:0,class:"w-full max-w-2xl bg-white/40 backdrop-blur-md rounded-[2.5rem] p-6 md:p-10 border border-white/60 mx-auto z-10 shadow-xl"},Pe={class:"flex justify-start mb-8"},Me={class:"bg-white/50 p-1.5 rounded-2xl flex items-center relative w-48 shadow-sm border border-white/60"},je={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ze={class:"flex flex-col gap-2"},Re={class:"text-xs font-bold opacity-70"},Te=["placeholder"],Be={class:"flex flex-col gap-2"},Ue={class:"text-xs font-bold opacity-70"},Oe={class:"flex flex-col gap-2"},Ge={class:"text-xs font-bold opacity-70"},Je=["placeholder"],We={class:"flex flex-col gap-2"},Xe={class:"text-xs font-bold opacity-70"},He={disabled:"",value:""},Ke=["value"],Qe={class:"flex flex-col gap-2"},Ye={class:"text-xs font-bold opacity-70"},Ze={disabled:"",value:""},Ve={value:1},et={value:0},tt={class:"flex flex-col gap-2"},st={class:"text-xs font-bold opacity-70"},lt={key:0,class:"grid grid-cols-3 gap-3 mb-3"},it=["src"],at=["onClick"],ot=["onChange"],rt={key:0,class:"grid grid-cols-3 gap-2 w-full"},dt=["src"],nt=["onClick"],ct={class:"flex items-center justify-center text-xs text-[#8F300E] font-bold bg-white/50 rounded-lg aspect-square border border-dashed border-[#8F300E]/30"},pt={key:1,class:"text-gray-500 group-hover:text-[#8F300E] flex flex-col items-center"},ut={class:"text-xs"},vt={class:"flex flex-col gap-2"},mt={class:"text-xs font-bold opacity-70"},ht=["placeholder"],ft={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},bt={class:"flex flex-col gap-2"},gt={class:"text-xs font-bold opacity-70"},_t=["placeholder"],xt={class:"flex flex-col gap-2"},yt={class:"text-xs font-bold opacity-70"},wt={class:"pt-4 border-t border-gray-200/20"},$t={class:"flex flex-col gap-2"},Et={class:"text-xs font-bold opacity-70"},Ct={class:"flex items-center gap-2 overflow-hidden"},kt={key:0,class:"text-gray-700 truncate"},qt={key:1,class:"text-gray-400"},At={class:"flex flex-col gap-2 mt-4"},Dt={class:"text-xs font-bold opacity-70"},Ft=["placeholder"],It={class:"pt-4"},Nt=["disabled"],Lt={key:0},St={key:1},Pt={key:1,class:"flex items-center justify-center min-h-[400px]"},C="w-full bg-white/40 border border-gray-100/50 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-1 focus:ring-[#8F300E]/50 focus:bg-white/60 transition-all placeholder:text-gray-400",J="w-full bg-white/40 border border-gray-100/50 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-1 focus:ring-[#8F300E]/50 focus:bg-white/60 transition-all text-gray-700",W="w-full bg-white/40 border border-gray-100/50 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-1 focus:ring-[#8F300E]/50 focus:bg-white/60 transition-all placeholder:text-gray-400 resize-none",f="border-red-500/50 focus:ring-red-500/20 bg-red-50/50",Mt={__name:"[id]",async setup(jt){let k,P;const F=ce().params.id,{t:r,locale:X}=pe(),H=O(()=>X.value==="ar"),K=be({titleAr:y().required(r("validation.required","مطلوب")).label(r("devices.nameAr","اسم الجهاز (عربي)")),titleEn:y().required("Required").label(r("devices.nameEn","اسم الجهاز (إنجليزي)")),supplierName:y().required(r("validation.required","مطلوب")).label(r("devices.supplier","اسم المورد")),deviceClassId:E().required(r("validation.required","مطلوب")).label(r("devices.class","الفئة")),isNew:E().required(r("validation.required","مطلوب")).label(r("devices.condition","حالة الجهاز")),lat:E().required(r("validation.required","مطلوب")).label(r("devices.lat","خط العرض")),lng:E().required(r("validation.required","مطلوب")).label(r("devices.lng","خط الطول")),mapDesc:y().required(r("validation.required","مطلوب")).label(r("devices.locationDesc","وصف الموقع")),price:E().required(r("validation.required","مطلوب")).label(r("devices.priceLabel","السعر")),descriptionAr:y().required(r("validation.required","مطلوب")).label(r("devices.descAr","وصف الجهاز (عربي)")),descriptionEn:y().required("Required").label(r("devices.descEn","وصف الجهاز (إنجليزي)")),images:ge().nullable().label(r("devices.images","صور الجهاز"))}),{handleSubmit:Q,setValues:Y,values:m,errors:M,setFieldValue:I}=_e({validationSchema:K}),N=x(!1),w=x("sale"),$=x([]),Z=[{value:1,label:r("devices.type_heavy","آلات ثقيلة")},{value:2,label:r("devices.type_medical","معدات طبية")},{value:3,label:r("devices.type_electronic","أجهزة إلكترونية")},{value:4,label:r("devices.type_agri","معدات زراعية")}],{delete:V}=ye(),{upload:ee}=we(),q=Ee(),te=ue(),A=x(!1),{data:se,pending:j,error:Rt}=([k,P]=ve(()=>$e(`/machine-details/${F}`)),k=await k,P(),k),z=O(()=>{var e;return(e=se.value)==null?void 0:e.data});me(z,e=>{e&&(Y({titleAr:e.title_ar,titleEn:e.title_en,supplierName:e.supplier_name||e.supplier_name_ar,deviceClassId:e.device_class_id,isNew:e.is_new?1:0,price:e.price,descriptionAr:e.description_ar,descriptionEn:e.description_en,lat:e.lat,lng:e.lng,mapDesc:e.map_desc,images:[]}),w.value=e.type,$.value=e.images||[])},{immediate:!0});const R=x(null),b=x(new Map);function le(){R.value.click()}function ie(e,l){const _=Array.from(e.target.files||[]);_.length&&(_.forEach(i=>{if(!b.value.has(i)){const a=URL.createObjectURL(i);b.value.set(i,a)}}),l(Array.from(b.value.keys())))}function ae(e,l){b.value.delete(e),l(Array.from(b.value.keys()))}const oe=e=>{I("lat",e.lat),I("lng",e.lng),I("mapDesc",e.address)},re=async e=>{if(confirm(r("devices.confirmDeleteImg","هل أنت متأكد من حذف هذه الصورة؟")))try{await V(`/delete-machine-img/${e}`),q.success(r("devices.deleteImgSuccess","تم حذف الصورة بنجاح")),$.value=$.value.filter(l=>l.id!==e)}catch{q.error(r("devices.deleteImgError","فشل حذف الصورة"))}};function T(e){return w.value===e?"flex-1 py-1.5 text-sm font-bold rounded-xl bg-[#8F300E] text-white shadow-md transition-all":"flex-1 py-1.5 text-sm font-bold rounded-xl text-gray-500 hover:bg-white/40 transition-all"}const B=Q(async e=>{A.value=!0;try{const l=new FormData;l.append("title[ar]",e.titleAr),l.append("title[en]",e.titleEn),l.append("supplier_name",e.supplierName),l.append("price",e.price),l.append("device_class_id",e.deviceClassId),l.append("is_new",e.isNew),l.append("type",w.value),l.append("description[ar]",e.descriptionAr),l.append("description[en]",e.descriptionEn),l.append("lat",e.lat),l.append("lng",e.lng),l.append("map_desc",e.mapDesc),e.images&&e.images.length&&e.images.forEach(_=>{l.append("images[]",_)}),await ee(`/edit-machine/${F}?_method=put`,l),q.success(r("devices.editSuccess","تم تعديل الجهاز بنجاح!")),he(te("/profile/more/devices"))}catch(l){q.error(l.error||r("devices.editError","حدث خطأ أثناء تعديل الجهاز"))}finally{A.value=!1}});return(e,l)=>{const _=de;return c(),n("div",Ne,[t("div",Le,[o(_,{items:[{label:e.$t("devices.breadcrumb.more","المزيد"),to:"/profile/more",active:!1},{label:e.$t("devices.breadcrumb.devices","الأجهزة"),to:"/profile/more/devices",active:!1},{label:e.$t("devices.edit","تعديل جهاز"),to:`/profile/more/devices/edit/${s(F)}`,active:!0}],direction:H.value?"rtl":"ltr"},null,8,["items","direction"])]),!s(j)&&z.value?(c(),n("div",Se,[t("div",Pe,[t("div",Me,[t("button",{type:"button",onClick:l[0]||(l[0]=i=>w.value="sale"),class:D(T("sale"))},d(e.$t("devices.sale","بيع")),3),t("button",{type:"button",onClick:l[1]||(l[1]=i=>w.value="rent"),class:D(T("rent"))},d(e.$t("devices.rent","إيجار")),3)])]),t("form",{onSubmit:l[4]||(l[4]=(...i)=>s(B)&&s(B)(...i)),class:"space-y-4"},[t("div",je,[t("div",ze,[t("label",Re,d(e.$t("devices.nameAr","اسم الجهاز (عربي)")),1),o(s(p),{name:"titleAr"},{default:v(({field:i,meta:a})=>[t("input",h(i,{placeholder:e.$t("devices.nameArPlaceholder","اسم الجهاز"),class:[C,a.touched&&a.invalid&&f]}),null,16,Te)]),_:1}),o(s(u),{name:"titleAr",class:"text-red-500 text-xs pr-1"})]),t("div",Be,[t("label",Ue,d(e.$t("devices.nameEn","اسم الجهاز (إنجليزي)")),1),o(s(p),{name:"titleEn"},{default:v(({field:i,meta:a})=>[t("input",h(i,{placeholder:"Device Name",dir:"ltr",class:[C,a.touched&&a.invalid&&f]}),null,16)]),_:1}),o(s(u),{name:"titleEn",class:"text-red-500 text-xs pr-1"})])]),t("div",Oe,[t("label",Ge,d(e.$t("devices.supplier","اسم المورد")),1),o(s(p),{name:"supplierName"},{default:v(({field:i,meta:a})=>[t("input",h(i,{placeholder:e.$t("devices.supplierPlaceholder","اسم المورد"),class:[C,a.touched&&a.invalid&&f]}),null,16,Je)]),_:1}),o(s(u),{name:"supplierName",class:"text-red-500 text-xs pr-1"})]),t("div",We,[t("label",Xe,d(e.$t("devices.class","الفئة")),1),o(s(p),{name:"deviceClassId"},{default:v(({field:i,meta:a})=>[t("select",h(i,{class:[J,a.touched&&a.invalid&&f]}),[t("option",He,d(e.$t("devices.selectClass","اختر الفئة")),1),(c(),n(L,null,S(Z,g=>t("option",{key:g.value,value:g.value},d(g.label),9,Ke)),64))],16)]),_:1}),o(s(u),{name:"deviceClassId",class:"text-red-500 text-xs pr-1"})]),t("div",Qe,[t("label",Ye,d(e.$t("devices.condition","حالة الجهاز")),1),o(s(p),{name:"isNew"},{default:v(({field:i,meta:a})=>[t("select",h(i,{class:[J,a.touched&&a.invalid&&f]}),[t("option",Ze,d(e.$t("devices.selectCondition","اختر حالة الجهاز")),1),t("option",Ve,d(e.$t("devices.new","جديد")),1),t("option",et,d(e.$t("devices.used","مستعمل")),1)],16)]),_:1}),o(s(u),{name:"isNew",class:"text-red-500 text-xs pr-1"})]),t("div",tt,[t("label",st,d(e.$t("devices.images","صور الجهاز")),1),$.value.length>0?(c(),n("div",lt,[(c(!0),n(L,null,S($.value,i=>(c(),n("div",{key:i.id,class:"relative aspect-square rounded-xl overflow-hidden border border-black/5 shadow-sm group"},[t("img",{src:i.image,class:"w-full h-full object-cover"},null,8,it),t("button",{type:"button",onClick:a=>re(i.id),class:"absolute top-1 right-1 bg-red-500/80 text-white p-1 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity"},[o(s(Ce),{size:14})],8,at)]))),128))])):G("",!0),o(s(p),{name:"images"},{default:v(({field:i,meta:a})=>[t("div",{onClick:le,class:D(["w-full bg-white/40 min-h-[6rem] rounded-xl border-2 border-dashed border-gray-400/30 flex flex-col items-center justify-center cursor-pointer hover:bg-white/60 transition overflow-hidden relative group p-4",[a.touched&&a.invalid&&"border-red-500/50"]])},[t("input",{type:"file",ref_key:"fileInput",ref:R,class:"hidden",accept:"image/*",multiple:"",onChange:g=>ie(g,i.onChange)},null,40,ot),b.value.size>0?(c(),n("div",rt,[(c(!0),n(L,null,S(b.value,([g,U])=>(c(),n("div",{key:U,class:"relative aspect-square rounded-lg overflow-hidden border border-black/10 group"},[t("img",{src:U,class:"w-full h-full object-cover"},null,8,dt),t("button",{type:"button",onClick:fe(Tt=>ae(g,i.onChange),["stop"]),class:"absolute top-1 right-1 bg-red-500/80 text-white p-1 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity"},[o(s(ke),{size:14})],8,nt)]))),128)),t("div",ct,[o(s(qe),{size:20})])])):(c(),n("div",pt,[o(s(Ie),{size:24,class:"mb-2 opacity-60"}),t("span",ut,d(e.$t("devices.uploadImages","اضغط لرفع صور إضافية")),1)]))],2)]),_:1}),o(s(u),{name:"images",class:"text-red-500 text-xs pr-1"})]),t("div",vt,[t("label",mt,d(e.$t("devices.priceLabel","السعر")),1),o(s(p),{name:"price"},{default:v(({field:i,meta:a})=>[t("input",h(i,{type:"number",placeholder:e.$t("devices.priceLabel","السعر"),class:[C,a.touched&&a.invalid&&f]}),null,16,ht)]),_:1}),o(s(u),{name:"price",class:"text-red-500 text-xs pr-1"})]),t("div",ft,[t("div",bt,[t("label",gt,d(e.$t("devices.descAr","وصف الجهاز (عربي)")),1),o(s(p),{name:"descriptionAr"},{default:v(({field:i,meta:a})=>[t("textarea",h(i,{placeholder:e.$t("devices.descArPlaceholder","وصف الجهاز"),rows:"4",class:[W,a.touched&&a.invalid&&f]}),null,16,_t)]),_:1}),o(s(u),{name:"descriptionAr",class:"text-red-500 text-xs pr-1"})]),t("div",xt,[t("label",yt,d(e.$t("devices.descEn","وصف الجهاز (إنجليزي)")),1),o(s(p),{name:"descriptionEn"},{default:v(({field:i,meta:a})=>[t("textarea",h(i,{placeholder:"Device Description",dir:"ltr",rows:"4",class:[W,a.touched&&a.invalid&&f]}),null,16)]),_:1}),o(s(u),{name:"descriptionEn",class:"text-red-500 text-xs pr-1"})])]),t("div",wt,[t("div",$t,[t("label",Et,d(e.$t("devices.location","الموقع")),1),t("div",{onClick:l[2]||(l[2]=i=>N.value=!0),class:D(["w-full bg-white/40 border border-gray-100/50 rounded-xl px-4 py-3 text-sm cursor-pointer hover:bg-white/60 transition-all flex items-center justify-between group",[s(M).lat||s(M).lng?"border-red-500/50 bg-red-50/50":""]])},[t("div",Ct,[o(s(De),{class:"w-4 h-4 text-[#8F300E] shrink-0"}),s(m).lat&&s(m).lng?(c(),n("span",kt,d(s(m).mapDesc||`${s(m).lat}, ${s(m).lng}`),1)):(c(),n("span",qt,d(e.$t("devices.selectLocationOnMap","اختر الموقع من الخريطة")),1))]),o(s(Fe),{class:"w-4 h-4 text-gray-400 group-hover:text-[#8F300E] transition-colors"})],2),o(s(p),{name:"lat",type:"hidden"}),o(s(p),{name:"lng",type:"hidden"}),o(s(u),{name:"lat",class:"text-red-500 text-xs pr-1"})]),t("div",At,[t("label",Dt,d(e.$t("devices.locationDesc","وصف الموقع بالتفصيل")),1),o(s(p),{name:"mapDesc"},{default:v(({field:i,meta:a})=>[t("input",h(i,{placeholder:e.$t("devices.locationPlaceholder","مثال: الرياض، حي الملقا"),class:[C,a.touched&&a.invalid&&f]}),null,16,Ft)]),_:1}),o(s(u),{name:"mapDesc",class:"text-red-500 text-xs pr-1"})])]),o(xe,{"is-open":N.value,"initial-lat":s(m).lat?Number(s(m).lat):24.7136,"initial-lng":s(m).lng?Number(s(m).lng):46.6753,onClose:l[3]||(l[3]=i=>N.value=!1),onLocationSelected:oe},null,8,["is-open","initial-lat","initial-lng"]),t("div",It,[t("button",{type:"submit",class:"w-full py-4 text-white font-bold text-lg rounded-xl shadow-lg bg-gradient-to-r from-[#8F300E] to-[#D2592D] hover:shadow-xl hover:scale-[1.01] transition-all disabled:opacity-50 disabled:cursor-not-allowed",disabled:A.value},[A.value?(c(),n("span",Lt,d(e.$t("devices.saving","جاري التعديل...")),1)):(c(),n("span",St,d(e.$t("devices.saveChanges","حفظ التعديلات")),1))],8,Nt)])],32)])):s(j)?(c(),n("div",Pt,l[5]||(l[5]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-4 border-[#8F300E] border-t-transparent"},null,-1)]))):G("",!0),l[6]||(l[6]=t("div",{class:"fixed inset-0 pointer-events-none -z-10 bg-[#E8E0DA]/30"},[t("div",{class:"absolute top-[-20%] left-[-10%] w-[60%] h-[60%] bg-[#D2592D]/5 rounded-full blur-[120px]"}),t("div",{class:"absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-[#8F300E]/10 rounded-full blur-[100px]"})],-1))])}}},ss=ne(Mt,[["__scopeId","data-v-6e91d35d"]]);export{ss as default};
