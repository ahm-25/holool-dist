import{E as D,G as I,H as j,r as b,g as G,k as R,c as l,o as d,a as t,b as n,t as i,S as W,M as f,C as o,w as k,T as $,F as E,B as F,d as H}from"./B5HeACpe.js";import{_ as O}from"./DiY3edDc.js";import{_ as U}from"./eznGetvW.js";import{c as J,b as x,g as P,u as K,F as p,E as m}from"./BqzWGWbE.js";import{a as Q,u as X}from"./CEwE9Az9.js";import{u as Y}from"./zDzW9YfH.js";import{C as T}from"./CS6AP1LE.js";import{P as Z}from"./8MZdU-4Z.js";import{L as ee}from"./ECYt8rtm.js";import"./CGfWc8dA.js";import"./aSvSgRgq.js";import"./BB7hngxF.js";import"./Yyz5NENq.js";import"./P9Gc60wC.js";const te={class:"min-h-screen py-8 px-4 flex flex-col"},se={class:"container mx-auto"},oe={class:"flex-1 flex items-center justify-center mt-6 mb-12"},ne={class:"bg-card rounded-[2rem] p-8 w-full max-w-2xl shadow-xl border border-white/40"},ae={class:"text-2xl font-bold text-[#5d4037] text-center mb-8"},re={class:"space-y-2"},ie={class:"block text-right text-[#5d4037] font-bold pr-2"},ce={class:"space-y-2"},le={class:"block text-right text-[#5d4037] font-bold pr-2"},de={class:"relative"},ue={value:"",disabled:"",selected:""},pe=["value"],me={class:"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500"},ve={class:"space-y-2"},he={class:"block text-right text-[#5d4037] font-bold pr-2"},be={class:"relative"},ge={value:"",disabled:"",selected:""},_e=["value"],fe={class:"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500"},xe={class:"space-y-2"},ye={class:"block text-right text-[#5d4037] font-bold pr-2"},we={class:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"},Ce={class:"border border-gray-500 rounded-full p-0.5"},ke={class:"space-y-2"},$e={class:"block text-right text-[#5d4037] font-bold pr-2"},Ee={class:"pt-4 w-[200px] mx-auto"},Fe=["disabled"],Pe={key:0},Te={key:1,class:"flex items-center justify-center gap-2"},He={__name:"contracts",setup(Se){const{t:a}=D(),{api:S}=Q(),{upload:A}=X(),y=Y(),B=I(),q=j(),v=b([]),h=b([]),g=b(!1),_=b({lat:null,lng:null}),L=G(()=>[{label:a("navigation.home"),to:"/"},{label:a("sections.medicalMaintenance.title"),to:"/profile/sections/maintaince"},{label:a("cards.maintenanceContracts.title"),active:!0}]),M=J({contractPeriod:P().transform((e,s)=>s===""?void 0:e).typeError(a("validation.number")).required(a("validation.required")).min(1,a("validation.minNumber",{min:1})),deviceCount:P().transform((e,s)=>s===""?void 0:e).typeError(a("validation.number")).required(a("validation.required")).min(1,a("validation.minNumber",{min:1})),serviceType:x().required(a("validation.required")),location:x().required(a("validation.required")),notes:x().nullable().max(1e3,a("validation.maxNotes",{max:1e3}))}),{handleSubmit:z,errors:u,setFieldValue:N,isSubmitting:w}=K({validationSchema:M,initialValues:{contractPeriod:"",deviceCount:"",serviceType:"",location:"",notes:""}});R(async()=>{try{const e=await S("/service-types-and-number-devices",{method:"GET"});console.log("Service and Devices API Response:",e),e&&e.key==="success"&&e.data?(v.value=e.data.service_types||[],h.value=e.data.number_devices||[]):e&&e.data?(v.value=e.data.service_types||[],h.value=e.data.number_devices||[]):e&&e.service_types?(v.value=e.service_types||[],h.value=e.number_devices||[]):console.warn("Unexpected API response structure:",e)}catch(e){console.error("Failed to fetch data:",e)}});const V=e=>{N("location",e.address),_.value={lat:e.lat,lng:e.lng}},C=z(async e=>{try{const s=new FormData;s.append("contract_period",e.contractPeriod),s.append("device_count",e.deviceCount),s.append("service_type_id",e.serviceType),s.append("map_desc",e.location),s.append("lat",_.value.lat||""),s.append("lng",_.value.lng||""),s.append("notes",e.notes||"");const r=await A("/orders/maintenance-contract/create-order",s);if(r&&(r.key==="success"||r.status===!0))y.success(r.msg||a("messages.success")),q.push(B("/profile/orders"));else throw new Error(r.msg||"Failed to submit order")}catch(s){console.error("Submission error:",s),y.error(s.error||s.message||a("error.somethingWentWrong"))}});return(e,s)=>(d(),l("div",te,[t("div",se,[n(O,{items:L.value},null,8,["items"])]),t("div",oe,[t("div",ne,[t("h1",ae,i(e.$t("cards.maintenanceContracts.title")),1),t("form",{onSubmit:s[1]||(s[1]=W((...r)=>o(C)&&o(C)(...r),["prevent"])),class:"space-y-6"},[t("div",re,[t("label",ie,i(e.$t("maintenance.contracts.contractPeriod")),1),n(o(p),{name:"contractPeriod",type:"number",min:"1",placeholder:e.$t("maintenance.contracts.contractPeriod"),class:f(["w-full bg-[#F5EBE0]/80 border-0 rounded-xl py-4 px-6 text-right placeholder-gray-400 focus:ring-2 focus:ring-[#A63C12]/50 outline-none block",{"ring-2 ring-red-500/50":o(u).contractPeriod}])},null,8,["placeholder","class"]),n(o(m),{name:"contractPeriod",class:"text-red-600 text-sm block text-right pr-2"})]),t("div",ce,[t("label",le,i(e.$t("maintenance.contracts.deviceCount")),1),t("div",de,[n(o(p),{name:"deviceCount"},{default:k(({field:r})=>[t("select",$(r,{class:["w-full bg-[#F5EBE0]/80 border-0 rounded-xl py-4 px-6 text-right placeholder-gray-400 focus:ring-2 focus:ring-[#A63C12]/50 outline-none appearance-none text-[#5d4037] h-[56px]",{"ring-2 ring-red-500/50":o(u).deviceCount}]}),[t("option",ue,i(e.$t("maintenance.contracts.selectDeviceCount")),1),(d(!0),l(E,null,F(h.value,c=>(d(),l("option",{key:c,value:c},i(c),9,pe))),128))],16)]),_:1}),t("div",me,[n(o(T),{size:"20"})])]),n(o(m),{name:"deviceCount",class:"text-red-600 text-sm block text-right pr-2"})]),t("div",ve,[t("label",he,i(e.$t("maintenance.contracts.serviceType")),1),t("div",be,[n(o(p),{name:"serviceType"},{default:k(({field:r})=>[t("select",$(r,{class:["w-full bg-[#F5EBE0]/80 border-0 rounded-xl py-4 px-6 text-right placeholder-gray-400 focus:ring-2 focus:ring-[#A63C12]/50 outline-none appearance-none text-[#5d4037] h-[56px]",{"ring-2 ring-red-500/50":o(u).serviceType}]}),[t("option",ge,i(e.$t("maintenance.contracts.selectServiceType")),1),(d(!0),l(E,null,F(v.value,c=>(d(),l("option",{key:c.id,value:c.id},i(c.name),9,_e))),128))],16)]),_:1}),t("div",fe,[n(o(T),{size:"20"})])]),n(o(m),{name:"serviceType",class:"text-red-600 text-sm block text-right pr-2"})]),t("div",xe,[t("label",ye,i(e.$t("maintenance.contracts.deviceLocation")),1),t("div",{class:"relative cursor-pointer",onClick:s[0]||(s[0]=r=>g.value=!0)},[n(o(p),{name:"location",type:"text",placeholder:e.$t("maintenance.contracts.deviceLocation"),class:f(["w-full bg-[#F5EBE0]/80 border-0 rounded-xl py-4 px-6 pl-12 text-right placeholder-gray-400 focus:ring-2 focus:ring-[#A63C12]/50 outline-none cursor-pointer",{"ring-2 ring-red-500/50":o(u).location}]),readonly:""},null,8,["placeholder","class"]),t("div",we,[t("div",Ce,[n(o(Z),{size:"14"})])])]),n(o(m),{name:"location",class:"text-red-600 text-sm block text-right pr-2"})]),t("div",ke,[t("label",$e,i(e.$t("maintenance.contracts.notes")),1),n(o(p),{name:"notes",as:"textarea",rows:"4",placeholder:e.$t("maintenance.contracts.notes"),class:f(["w-full bg-[#F5EBE0]/80 border-0 rounded-xl py-4 px-6 text-right placeholder-gray-400 focus:ring-2 focus:ring-[#A63C12]/50 outline-none resize-none",{"ring-2 ring-red-500/50":o(u).notes}])},null,8,["placeholder","class"]),n(o(m),{name:"notes",class:"text-red-600 text-sm block text-right pr-2"})]),t("div",Ee,[t("button",{type:"submit",disabled:o(w),class:"w-full background-btn text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-xl transition-all active:scale-[0.98] disabled:opacity-70 disabled:cursor-not-allowed"},[o(w)?(d(),l("span",Te,[H(i(e.$t("common.sending"))+" ",1),n(o(ee),{class:"animate-spin",size:"20"})])):(d(),l("span",Pe,i(e.$t("common.send")),1))],8,Fe)])],32)])]),n(U,{"is-open":g.value,onClose:s[2]||(s[2]=r=>g.value=!1),onLocationSelected:V},null,8,["is-open"])]))}};export{He as default};
