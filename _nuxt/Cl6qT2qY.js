import{c as p,o as m,a as o,t as c,d as tt,S as k,b as h,C as a,E as et,H as ot,r as v,W as st,k as at,a0 as nt,n as rt,g as it,J as x,F as lt,B as ct,O as j,P as L,M as B,Y as E,A as dt,R as ut}from"./c72oGId3.js";import{_ as mt}from"./e2BhSMQC.js";import{T as pt}from"./qtti5JJ1.js";import{P as T}from"./BLmtJ4Y0.js";import{M as ft}from"./CPax9l0L.js";import{_ as ht}from"./BFzf2P3Y.js";import{_ as bt}from"./DxOD6fZ8.js";import{u as vt}from"./C_Rn6DEZ.js";import{c as gt,b as O,u as yt}from"./CRRIYHK-.js";import{a as _t,u as xt,b as wt}from"./DACiwXMA.js";import"./JgLJjp22.js";import"./DMlAnEmj.js";import"./Dc2lQKBP.js";import"./DwLa6hif.js";import"./CzzcvkpU.js";const $t={class:"flex items-start justify-between"},kt={class:"flex gap-4 text-right"},Ct={class:"w-20 h-20 rounded-lg overflow-hidden border-2 border-white shadow-sm shrink-0"},Mt=["src","alt"],qt={class:"flex flex-col"},Ft={class:"font-bold text-lg text-gray-900"},St={class:"text-sm text-gray-600 mb-2"},At={class:"text-[#A63C12] font-bold flex items-center gap-1"},Dt={class:"flex flex-col justify-between h-full min-h-[80px] items-end"},jt={class:"mt-4 flex items-center bg-[#F5EBE0]/80 rounded-full px-2 py-1 border border-[#A63C12]/30"},Lt={class:"mx-3 font-bold text-gray-800 w-4 text-center"},Bt=["disabled"],Et={__name:"CartItem",props:{item:{type:Object,required:!0}},emits:["updateQuantity","remove","click"],setup(n){return(d,r)=>(m(),p("div",{onClick:r[3]||(r[3]=i=>d.$emit("click",n.item)),class:"bg-white/40 backdrop-blur-sm rounded-xl p-4 mb-4 border border-white/50 shadow-sm hover:shadow-md transition-shadow cursor-pointer"},[o("div",$t,[o("div",kt,[o("div",Ct,[o("img",{src:n.item.image,alt:n.item.name,class:"w-full h-full object-cover"},null,8,Mt)]),o("div",qt,[o("h3",Ft,c(n.item.name),1),o("p",St,c(n.item.category),1),o("p",At,[tt(c(n.item.price*n.item.quantity)+" ",1),r[4]||(r[4]=o("img",{src:mt,class:"w-4 h-4 object-contain",alt:"SAR"},null,-1))])])]),o("div",Dt,[o("button",{onClick:r[0]||(r[0]=k(i=>d.$emit("remove",n.item.id),["stop"])),class:"text-red-500 hover:text-red-700 p-1 transition-colors"},[h(a(pt),{size:"20"})]),o("div",jt,[o("button",{onClick:r[1]||(r[1]=k(i=>d.$emit("updateQuantity",n.item.id,1),["stop"])),class:"w-6 h-6 flex items-center justify-center background-btn text-white rounded-full hover:bg-black transition-colors"},[h(a(T),{size:"12"})]),o("span",Lt,c(n.item.quantity),1),o("button",{onClick:r[2]||(r[2]=k(i=>d.$emit("updateQuantity",n.item.id,-1),["stop"])),disabled:n.item.quantity<=1,class:"w-6 h-6 flex items-center justify-center bg-gray-900 text-white rounded-full hover:bg-black transition-colors"},[h(a(ft),{size:"12"})],8,Bt)])])])]))}},Ot={class:"container mx-auto"},Tt={class:"min-h-screen p-4 md:p-8 flex justify-center font-sans"},zt={class:"w-full flex flex-col lg:flex-row gap-6 justify-center"},Pt={class:"w-full text-center lg:w-2/3"},It={key:0,class:"bg-white/30 backdrop-blur-sm rounded-3xl p-12 text-center"},Qt={class:"text-xl text-gray-600"},Rt={key:0,class:"w-full lg:w-1/3 bg-white/40 backdrop-blur-md rounded-3xl p-6 shadow-xl border border-white/50 h-fit sticky top-8"},Nt={class:"mb-6"},Ut={class:"block text-gray-700 font-bold mb-2 text-right"},Vt={class:"relative"},Ht=["placeholder"],Jt={class:"border border-current rounded-full p-0.5"},Wt={key:0,class:"text-red-500 text-sm mt-1 block text-right"},Yt={class:"mb-8"},Gt={class:"block text-gray-700 font-bold mb-2 text-right"},Kt=["placeholder"],Xt={key:0,class:"text-red-500 text-sm mt-1 block text-right"},he={__name:"index",async setup(n){let d,r;const{t:i}=et(),{success:C,error:M}=vt();ot();const l=v([]),g=v(!1),y=v(!1),w=v(24.7136),$=v(46.6753),z=gt({location:O().required(i("validation.required")),notes:O().nullable()}),{handleSubmit:P,errors:f,defineField:q,setFieldValue:I,resetForm:Q}=yt({validationSchema:z,initialValues:{location:"",notes:""}}),[_]=q("location"),[b]=q("notes"),{data:R,pending:Zt,refresh:F}=([d,r]=st(()=>wt("/orders/get-cart-items")),d=await d,r(),d);at(()=>{F()}),nt(()=>{F(),Q(),y.value=!1,g.value=!1}),rt(R,t=>{t!=null&&t.data&&(l.value=t.data.map(e=>({id:e.id,machine_id:e.machine_id,name:e.machine_title,category:e.machine_device_class,price:e.quantity>0?e.total_price/e.quantity:0,quantity:e.quantity,image:e.machine_image||"https://picsum.photos/id/1/200/200"})))},{immediate:!0});const N=(t,e)=>{l.value=l.value.map(s=>s.id===t?{...s,quantity:Math.max(1,s.quantity+e)}:s)},{delete:U}=_t(),{upload:V}=xt(),H=async t=>{try{await U(`/orders/remove-from-cart/${t}`),l.value=l.value.filter(e=>e.id!==t),C(i("cart.item_removed_success"))}catch(e){console.error(e),M(i("cart.item_remove_error"))}},J=it(()=>l.value.reduce((t,e)=>t+e.price*e.quantity,0)),S=()=>{g.value=!1},W=t=>{ut({path:"/profile/product-details",query:{id:t.machine_id||t.id,name:t.name,category:t.category,price:t.price,image:t.image}})},Y=()=>{y.value=!0},G=()=>{y.value=!1},K=({lat:t,lng:e,address:s})=>{w.value=t,$.value=e,I("location",s)},A=P(t=>{g.value=!0}),X=async({method:t,callback:e})=>{try{const s=new FormData;s.append("map_desc",_.value||i("cart.default_location")),s.append("lat",w.value.toString()),s.append("lng",$.value.toString()),s.append("pay_type",t.key),b.value&&s.append("notes",b.value);const D=await V("/orders/create-cart-order",s);C(`${i("cart.payment_success")} ${(t==null?void 0:t.slug_text)||i("cart.card")}`),l.value=[],S()}catch(s){console.error(s),M((s==null?void 0:s.error)||i("cart.payment_error"))}finally{e()}};return(t,e)=>{const s=Et,D=ht,Z=bt;return m(),p("main",Ot,[o("div",Tt,[o("div",zt,[o("div",Pt,[(m(!0),p(lt,null,ct(l.value,u=>(m(),dt(s,{key:u.id,item:u,onUpdateQuantity:N,onRemove:H,onClick:W},null,8,["item"]))),128)),l.value.length===0?(m(),p("div",It,[o("p",Qt,c(t.$t("cart.empty")),1)])):x("",!0)]),l.value.length>0?(m(),p("div",Rt,[o("div",Nt,[o("label",Ut,c(t.$t("cart.device_location")),1),o("div",Vt,[j(o("input",{"onUpdate:modelValue":e[0]||(e[0]=u=>E(_)?_.value=u:null),placeholder:t.$t("cart.device_location"),type:"text",class:B(["w-full bg-[#F5EBE0]/50 border border-white/50 rounded-xl py-3 px-4 pl-10 text-right focus:outline-none focus:ring-2 focus:ring-primary/50 placeholder:text-gray-400",{"border-red-500":a(f).location}])},null,10,Ht),[[L,a(_)]]),o("button",{onClick:Y,type:"button",class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-primary transition-colors"},[o("div",Jt,[h(a(T),{size:"16"})])])]),a(f).location?(m(),p("span",Wt,c(a(f).location),1)):x("",!0)]),o("div",Yt,[o("label",Gt,c(t.$t("cart.notes")),1),j(o("textarea",{"onUpdate:modelValue":e[1]||(e[1]=u=>E(b)?b.value=u:null),rows:"4",placeholder:t.$t("cart.notes"),class:B(["w-full bg-[#F5EBE0]/50 border border-white/50 rounded-xl py-3 px-4 text-right focus:outline-none focus:ring-2 focus:ring-primary/50 placeholder:text-gray-400 resize-none",{"border-red-500":a(f).notes}])},null,10,Kt),[[L,a(b)]]),a(f).notes?(m(),p("span",Xt,c(a(f).notes),1)):x("",!0)]),o("button",{onClick:e[2]||(e[2]=(...u)=>a(A)&&a(A)(...u)),class:"w-full hover:bg-[#8a320f] text-white font-bold py-3 rounded-xl shadow-lg active:scale-95 transition-all background-btn"},c(t.$t("cart.checkout")),1)])):x("",!0)]),h(D,{isOpen:g.value,total:J.value,type:"store",onClose:S,onSubmit:X},null,8,["isOpen","total"]),h(Z,{isOpen:y.value,initialLat:w.value,initialLng:$.value,onClose:G,onLocationSelected:K},null,8,["isOpen","initialLat","initialLng"])])])}}};export{he as default};
