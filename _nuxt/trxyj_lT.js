import{a4 as Q,W as Y,n as T,G as K,c as n,a as s,b as f,C as v,d as X,t as o,J as y,F as C,B as q,w as Z,M as ee,S as te,a3 as ae,r as m,m as d,N as se,o as i}from"./C4psxivV.js";import{_ as le,C as oe,P as re}from"./B8Xa5zt0.js";import{_ as ne}from"./Xa7VVDiu.js";import{_ as ie}from"./BfFQRezz.js";import{b as F}from"./BBqTzrqY.js";import"./DAdbB4PO.js";import"./BAInQ3nS.js";import"./DP7RF7SH.js";import"./D6-jFKJQ.js";const ce={class:"min-h-screen pb-20 overflow-x-hidden relative"},de={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},ue={key:0,class:"mt-6 p-4 rounded-2xl bg-red-50/80 border border-red-200 text-red-700"},pe={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6"},me={class:"w-full mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 fade-in"},fe={class:"flex justify-between items-start mb-4"},ve={class:"flex flex-col items-start gap-1"},ge={class:"text-[#8b7e77] text-sm"},be={class:"text-[#5d5551] font-bold text-lg"},_e={class:"flex items-start gap-3"},he={class:"flex flex-col items-end"},ye={class:"font-bold text-[#5d5551] text-lg"},xe={class:"flex items-center gap-1 text-[#9ca3af] text-xs mt-0.5"},we={class:"w-10 h-10 rounded-lg border border-[#bf4e26]/30 flex items-center justify-center text-[#bf4e26] bg-[#bf4e26]/10"},ke={class:"flex justify-between items-end mt-2 pt-3 border-t border-[#bf4e26]/10"},Ce={class:"flex flex-col gap-1"},$e={class:"text-[#8b7e77] text-sm"},Ne={class:"font-bold text-[#5d5551]"},je={class:"flex flex-col gap-2 items-end"},Pe=["onClick"],Ae=["onClick"],Me={key:1,class:"col-span-full flex flex-col items-center justify-center py-20 text-[#8b7e77] opacity-60"},Te={class:"text-lg font-medium"},qe={class:"text-center text-gray-800 font-bold text-lg mb-6"},Fe={class:"space-y-3 mb-8"},Ee=["onClick"],Oe={class:"w-5 h-5 rounded-full border border-gray-300 flex items-center justify-center p-0.5"},De={key:0,class:"w-full h-full bg-red-500 rounded-full"},Ie={class:"font-medium text-gray-700 text-right flex-1 mr-4"},Se={class:"flex flex-col gap-3"},Re=["disabled"],Be={key:0,class:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"},Ke={__name:"index",async setup(Le){let x,E;const w=m("NEW"),c=m(1),$=d(()=>({NEW:"new",PAYMENT:"waiting_for_pay",CURRENT:"current",FINISHED:"finished"})[w.value]||"new"),g=Q(),B=d(()=>({status:$.value,page:c.value,tab:g.query.tab||"sent"})),L=d(()=>`orders-market-offers-${$.value}-${c.value}-${g.query.tab||"sent"}`),{data:U,pending:O,error:V,refresh:N}=([x,E]=Y(()=>F("/orders/market-offers",{query:B,watch:[$,c],server:!1,key:L})),x=await x,E(),x),D=d(()=>{const e=U.value;if(!e||typeof e!="object")return e;const l=e,a=l?.data&&typeof l.data=="object"?l.data:l,r=a?.data&&typeof a.data=="object"?a.data:a,p=r?.pagination??a?.pagination??l?.pagination;return p&&r&&typeof r=="object"&&!Array.isArray(r)&&!r.pagination?{...r,pagination:p}:r}),I=d(()=>{const e=D.value;return Array.isArray(e?.orders)&&e.orders||Array.isArray(e?.data?.orders)&&e.data.orders||Array.isArray(e)&&e||[]}),S=d(()=>{const e=D.value,l=p=>{if(!p||typeof p!="string")return null;try{const h=new URL(p).searchParams.get("page"),M=Number(h);return Number.isFinite(M)&&M>0?M:null}catch{const A=p.match(/[?&]page=(\d+)/);if(!A)return null;const h=Number(A[1]);return Number.isFinite(h)&&h>0?h:null}},a=e?.pagination?.total_pages??e?.pagination?.totalPages??e?.total_pages??e?.last_page??e?.meta?.last_page??e?.pagination?.last_page??e?.data?.last_page??(e?.total&&e?.per_page?Math.ceil(Number(e.total)/Number(e.per_page)):null)??(e?.pagination?.total_items&&e?.pagination?.per_page?Math.ceil(Number(e.pagination.total_items)/Number(e.pagination.per_page)):null)??l(e?.last_page_url)??l(e?.pagination?.next_page_url)??1,r=Number(a);return Number.isFinite(r)&&r>0?r:1}),R=d(()=>V.value?t("profile.orders.market.loadQuotesError"):null),z=d(()=>O.value);T(()=>g.query.tab,()=>{N()}),T(w,()=>{c.value=1}),T([S,O],([e,l])=>{l||(c.value>e&&(c.value=e||1),c.value<1&&(c.value=1))});const W=e=>{w.value=e},b=m(!1),j=m([]),u=m(null),k=m(null),_=m(null),G=async e=>{if(k.value=e,u.value=null,j.value.length===0)try{const{data:l}=await F("/cancel-reasons");l.value?.key==="success"&&(j.value=l.value.data)}catch(l){console.error("Failed to fetch cancel reasons",l)}b.value=!0},H=async()=>{if(!(!u.value||!k.value||_.value)){_.value=k.value;try{const{data:e}=await F("/orders/cancel-order",{method:"POST",body:{order_id:k.value,cancel_type_reason_id:u.value}});e.value&&(e.value.key==="success"||e.value.status===!0)&&(b.value=!1,N())}catch(e){console.error("Failed to cancel order",e)}finally{_.value=null}}},J=e=>{se(P({path:`/profile/orders/market/quotes/${e}`,query:{tab:g.query.tab||"sent"}}))},P=K();return(e,l)=>(i(),n("div",ce,[s("div",de,[f(ie,{items:[{label:"الطلبات",to:v(P)("/profile/orders"),active:!1},{label:e.$t("categories.medicalSales.title"),to:v(P)({path:"/profile/orders/market",query:{tab:v(g).query?.tab||"sent"}}),active:!1},{label:e.$t("profile.orders.menuItems.quotes"),active:!0}]},null,8,["items"]),f(le,{"active-tab":w.value,onChange:W},null,8,["active-tab"]),R.value?(i(),n("div",ue,[X(o(R.value)+" ",1),s("button",{class:"underline font-semibold ms-2",onClick:l[0]||(l[0]=a=>v(N)())},o(e.$t("cards.maintenanceDetails.retry")),1)])):y("",!0),z.value?(i(),n("div",pe,[(i(),n(C,null,q(6,a=>s("div",{key:a,class:"animate-pulse rounded-2xl bg-white/40 h-[150px]"})),64))])):(i(),n(C,{key:2},[s("div",me,[I.value.length?(i(!0),n(C,{key:0},q(I.value,a=>(i(),n("div",{key:a.id??a.order_num,class:"group bg-white/40 backdrop-blur-sm border border-white/60 rounded-2xl p-5 shadow-sm hover:shadow-md hover:bg-white/60 transition-all duration-300 flex flex-col justify-between min-h-[140px]"},[s("div",fe,[s("div",ve,[s("span",ge,o(e.$t("cards.maintenanceDetails.serviceType"))+" :",1),s("span",be,o(a.type_text??a.serviceType??"-"),1)]),s("div",_e,[s("div",he,[s("span",ye,o(a.order_num??a.id),1),s("div",xe,[f(v(oe),{class:"w-3 h-3"}),s("span",null,o(a.created_at??a.time??""),1)])]),s("div",we,[f(v(re),{class:"w-5 h-5"})])])]),s("div",ke,[s("div",Ce,[s("span",$e,o(e.$t("cards.maintenanceDetails.status"))+" :",1),s("span",Ne,o(a.status_text??a.status??""),1)]),s("div",je,[s("button",{onClick:r=>J(a.id),class:"text-primary font-bold text-sm hover:underline"},o(e.$t("common.viewOrder")),9,Pe),a.buttons?.cancel?(i(),n("button",{key:0,onClick:r=>G(a.id),class:"text-red-500 font-bold text-xs hover:underline flex items-center gap-1"},o(e.$t("cards.maintenanceDetails.cancelOrder")),9,Ae)):y("",!0)])])]))),128)):(i(),n("div",Me,[l[5]||(l[5]=s("div",{class:"w-16 h-16 mb-4 rounded-full border-2 border-dashed border-[#8b7e77] flex items-center justify-center"},[s("span",{class:"text-2xl"},"!")],-1)),s("p",Te,o(e.$t("profile.orders.noOrders")),1)]))]),f(ne,{page:c.value,"onUpdate:page":l[1]||(l[1]=a=>c.value=a),totalPages:S.value},null,8,["page","totalPages"])],64))]),f(ae,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-200 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:Z(()=>[b.value?(i(),n("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:l[4]||(l[4]=a=>b.value=!1)},[s("div",{class:"bg-white/90 backdrop-blur-md w-full max-w-lg rounded-3xl p-6 shadow-2xl border border-white/20",onClick:l[3]||(l[3]=te(()=>{},["stop"]))},[s("h3",qe,o(e.$t("cancelModal.title")),1),s("div",Fe,[(i(!0),n(C,null,q(j.value,a=>(i(),n("div",{key:a.id,onClick:r=>u.value=a.id,class:ee(["flex items-center justify-between p-4 rounded-xl cursor-pointer transition-all border group",u.value===a.id?"bg-red-50 border-red-200 ring-1 ring-red-200":"bg-gray-50 border-transparent hover:bg-gray-100"])},[s("div",Oe,[u.value===a.id?(i(),n("div",De)):y("",!0)]),s("span",Ie,o(a.name),1)],10,Ee))),128))]),s("div",Se,[s("button",{onClick:H,disabled:!u.value||_.value,class:"w-full bg-[#E57373] text-white py-3 rounded-xl font-bold text-lg shadow-lg hover:bg-[#d45d5d] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[_.value?(i(),n("div",Be)):y("",!0),s("span",null,o(e.$t("cancelModal.confirm")),1)],8,Re),s("button",{onClick:l[2]||(l[2]=a=>b.value=!1),class:"w-full bg-gray-100 text-gray-600 py-3 rounded-xl font-bold text-lg hover:bg-gray-200 transition-colors"},o(e.$t("cancelModal.cancel")),1)])])])):y("",!0)]),_:1})]))}};export{Ke as default};
