import{E as R,G as W,H as O,g as U,a0 as J,c as i,a as t,b as n,t as r,S as K,M as y,C as o,w,T as P,F as S,B as A,d as Q,r as u,m as X,o as c}from"./BrVuSVAX.js";import{_ as Y}from"./3wX53bXY.js";import{_ as Z}from"./DUYNdDJa.js";import{D as ee}from"./C6Z4rP2l.js";import{c as te,b as C,g as L,u as se,F as p,E as v}from"./0swuOlqD.js";import{a as oe,u as ne}from"./CyV_D5dN.js";import{u as ae}from"./CeFifFvi.js";import{C as B}from"./B7EA4xYm.js";import{P as re}from"./DHqVk_hH.js";import{L as le}from"./DHPnNOIh.js";import"./BPPjlZ9P.js";import"./DRfJZgfE.js";import"./_ymiwOyQ.js";import"./mufRz9kk.js";import"./BJD3ubJj.js";const ie={class:"min-h-screen py-8 px-4 flex flex-col"},ce={class:"container mx-auto"},de={class:"flex-1 flex items-center justify-center mt-6 mb-12"},ue={class:"bg-card rounded-[2rem] p-8 w-full max-w-2xl shadow-xl border border-white/40"},me={class:"text-2xl font-bold text-[#5d4037] text-center mb-8"},pe={class:"space-y-2"},ve={class:"block text-right text-[#5d4037] font-bold pr-2"},he={class:"space-y-2"},fe={class:"block text-right text-[#5d4037] font-bold pr-2"},be={class:"relative"},ge={value:"",disabled:"",selected:""},xe=["value"],_e={class:"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500"},ye={class:"space-y-2"},we={class:"block text-right text-[#5d4037] font-bold pr-2"},Ce={class:"relative"},ke={value:"",disabled:"",selected:""},$e=["value"],Ee={class:"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500"},Fe={class:"space-y-2"},Te={class:"block text-right text-[#5d4037] font-bold pr-2"},Pe={class:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"},Se={class:"border border-gray-500 rounded-full p-0.5"},Ae={class:"space-y-2"},Le={class:"block text-right text-[#5d4037] font-bold pr-2"},Be={class:"pt-4 w-[200px] mx-auto"},Me=["disabled"],qe={key:0},ze={key:1,class:"flex items-center justify-center gap-2"},De={class:"flex flex-col items-center w-full"},Ne={class:"text-2xl font-bold text-[#5d4037] mb-6"},Ve={key:0,class:"flex items-center justify-center p-8 text-gray-500"},Ie=["innerHTML"],ot={__name:"contracts",setup(je){const{t:l}=R(),{api:k}=oe(),{upload:M}=ne(),$=ae(),q=W(),z=O(),h=u([]),f=u([]),b=u(!1),g=u({lat:null,lng:null}),x=u(!1),E=u(""),_=u(!1),D=X(()=>[{label:l("navigation.home"),to:"/"},{label:l("sections.medicalMaintenance.title"),to:"/profile/sections/maintaince"},{label:l("cards.maintenanceContracts.title"),active:!0}]),N=te({contractPeriod:L().transform((e,s)=>s===""?void 0:e).typeError(l("validation.number")).required(l("validation.required")).min(1,l("validation.minNumber",{min:1})),deviceCount:L().transform((e,s)=>s===""?void 0:e).typeError(l("validation.number")).required(l("validation.required")).min(1,l("validation.minNumber",{min:1})),serviceType:C().required(l("validation.required")),location:C().required(l("validation.required")),notes:C().nullable().max(1e3,l("validation.maxNotes",{max:1e3}))}),{handleSubmit:V,errors:m,setFieldValue:I,isSubmitting:F,resetForm:j}=se({validationSchema:N,initialValues:{contractPeriod:"",deviceCount:"",serviceType:"",location:"",notes:""}}),G=async()=>{_.value=!0;try{const e=await k("/maintenance-conditions",{method:"GET",auth:!1});e&&(e.key==="success"||e.status===!0)&&(E.value=e.data||e.content||"",x.value=!0)}catch(e){console.error("Failed to fetch terms:",e)}finally{_.value=!1}};U(async()=>{try{const e=await k("/service-types-and-number-devices",{method:"GET"});console.log("Service and Devices API Response:",e),e&&e.key==="success"&&e.data?(h.value=e.data.service_types||[],f.value=e.data.number_devices||[]):e&&e.data?(h.value=e.data.service_types||[],f.value=e.data.number_devices||[]):e&&e.service_types?(h.value=e.service_types||[],f.value=e.number_devices||[]):console.warn("Unexpected API response structure:",e)}catch(e){console.error("Failed to fetch data:",e)}G()}),J(()=>{j(),b.value=!1,g.value={lat:null,lng:null}});const H=e=>{I("location",e.address),g.value={lat:e.lat,lng:e.lng}},T=V(async e=>{try{const s=new FormData;s.append("contract_period",e.contractPeriod),s.append("device_count",e.deviceCount),s.append("service_type_id",e.serviceType),s.append("map_desc",e.location),s.append("lat",g.value.lat||""),s.append("lng",g.value.lng||""),s.append("notes",e.notes||"");const a=await M("/orders/maintenance-contract/create-order",s);if(a&&(a.key==="success"||a.status===!0))$.success(a.msg||l("messages.success")),z.push(q("/profile/orders"));else throw new Error(a.msg||"Failed to submit order")}catch(s){console.error("Submission error:",s),$.error(s.error||s.message||l("error.somethingWentWrong"))}});return(e,s)=>(c(),i("div",ie,[t("div",ce,[n(Y,{items:D.value},null,8,["items"])]),t("div",de,[t("div",ue,[t("h1",me,r(e.$t("cards.maintenanceContracts.title")),1),t("form",{onSubmit:s[1]||(s[1]=K((...a)=>o(T)&&o(T)(...a),["prevent"])),class:"space-y-6"},[t("div",pe,[t("label",ve,r(e.$t("maintenance.contracts.contractPeriod")),1),n(o(p),{name:"contractPeriod",type:"number",min:"1",placeholder:e.$t("maintenance.contracts.contractPeriod"),class:y(["w-full bg-[#F5EBE0]/80 border-0 rounded-xl py-4 px-6 text-right placeholder-gray-400 focus:ring-2 focus:ring-[#A63C12]/50 outline-none block",{"ring-2 ring-red-500/50":o(m).contractPeriod}])},null,8,["placeholder","class"]),n(o(v),{name:"contractPeriod",class:"text-red-600 text-sm block text-right pr-2"})]),t("div",he,[t("label",fe,r(e.$t("maintenance.contracts.deviceCount")),1),t("div",be,[n(o(p),{name:"deviceCount"},{default:w(({field:a})=>[t("select",P(a,{class:["w-full bg-[#F5EBE0]/80 border-0 rounded-xl py-4 px-6 text-right placeholder-gray-400 focus:ring-2 focus:ring-[#A63C12]/50 outline-none appearance-none text-[#5d4037] h-[56px]",{"ring-2 ring-red-500/50":o(m).deviceCount}]}),[t("option",ge,r(e.$t("maintenance.contracts.selectDeviceCount")),1),(c(!0),i(S,null,A(f.value,d=>(c(),i("option",{key:d,value:d},r(d),9,xe))),128))],16)]),_:1}),t("div",_e,[n(o(B),{size:"20"})])]),n(o(v),{name:"deviceCount",class:"text-red-600 text-sm block text-right pr-2"})]),t("div",ye,[t("label",we,r(e.$t("maintenance.contracts.serviceType")),1),t("div",Ce,[n(o(p),{name:"serviceType"},{default:w(({field:a})=>[t("select",P(a,{class:["w-full bg-[#F5EBE0]/80 border-0 rounded-xl py-4 px-6 text-right placeholder-gray-400 focus:ring-2 focus:ring-[#A63C12]/50 outline-none appearance-none text-[#5d4037] h-[56px]",{"ring-2 ring-red-500/50":o(m).serviceType}]}),[t("option",ke,r(e.$t("maintenance.contracts.selectServiceType")),1),(c(!0),i(S,null,A(h.value,d=>(c(),i("option",{key:d.id,value:d.id},r(d.name),9,$e))),128))],16)]),_:1}),t("div",Ee,[n(o(B),{size:"20"})])]),n(o(v),{name:"serviceType",class:"text-red-600 text-sm block text-right pr-2"})]),t("div",Fe,[t("label",Te,r(e.$t("maintenance.contracts.deviceLocation")),1),t("div",{class:"relative cursor-pointer",onClick:s[0]||(s[0]=a=>b.value=!0)},[n(o(p),{name:"location",type:"text",placeholder:e.$t("maintenance.contracts.deviceLocation"),class:y(["w-full bg-[#F5EBE0]/80 border-0 rounded-xl py-4 px-6 pl-12 text-right placeholder-gray-400 focus:ring-2 focus:ring-[#A63C12]/50 outline-none cursor-pointer",{"ring-2 ring-red-500/50":o(m).location}]),readonly:""},null,8,["placeholder","class"]),t("div",Pe,[t("div",Se,[n(o(re),{size:"14"})])])]),n(o(v),{name:"location",class:"text-red-600 text-sm block text-right pr-2"})]),t("div",Ae,[t("label",Le,r(e.$t("maintenance.contracts.notes")),1),n(o(p),{name:"notes",as:"textarea",rows:"4",placeholder:e.$t("maintenance.contracts.notes"),class:y(["w-full bg-[#F5EBE0]/80 border-0 rounded-xl py-4 px-6 text-right placeholder-gray-400 focus:ring-2 focus:ring-[#A63C12]/50 outline-none resize-none",{"ring-2 ring-red-500/50":o(m).notes}])},null,8,["placeholder","class"]),n(o(v),{name:"notes",class:"text-red-600 text-sm block text-right pr-2"})]),t("div",Be,[t("button",{type:"submit",disabled:o(F),class:"w-full background-btn text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-xl transition-all active:scale-[0.98] disabled:opacity-70 disabled:cursor-not-allowed"},[o(F)?(c(),i("span",ze,[Q(r(e.$t("common.sending"))+" ",1),n(o(le),{class:"animate-spin",size:"20"})])):(c(),i("span",qe,r(e.$t("common.send")),1))],8,Me)])],32)])]),n(Z,{"is-open":b.value,onClose:s[2]||(s[2]=a=>b.value=!1),onLocationSelected:H},null,8,["is-open"]),n(ee,{visible:x.value,onClose:s[4]||(s[4]=a=>x.value=!1),width:"600px"},{default:w(()=>[t("div",De,[t("h3",Ne,r(e.$t("common.termsAndConditions")||"الشروط والاحكام"),1),_.value?(c(),i("div",Ve,r(e.$t("common.loading"))+"... ",1)):(c(),i("div",{key:1,class:"text-gray-600 text-sm mb-8 max-h-[60vh] overflow-y-auto leading-loose text-center px-4 w-full",innerHTML:E.value},null,8,Ie)),t("button",{onClick:s[3]||(s[3]=a=>x.value=!1),class:"w-full background-btn text-white font-bold py-3 rounded-xl shadow-lg transition-colors"},r(e.$t("common.agree")||"موافقة"),1)])]),_:1},8,["visible"])]))}};export{ot as default};
