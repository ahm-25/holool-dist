import{E as I,G as j,H as G,g as R,a0 as W,c as l,a as t,b as a,t as i,S as H,M as f,C as o,w as k,T as $,F as E,B as F,d as O,r as _,m as U,o as d}from"./BbGrFMje.js";import{_ as J}from"./ugLHR3pJ.js";import{_ as K}from"./BAZSyHqI.js";import{c as Q,b as x,g as P,u as X,F as p,E as m}from"./AmEKYDf3.js";import{a as Y,u as Z}from"./7lnyPs4D.js";import{u as ee}from"./BSK9vcVU.js";import{C as T}from"./BEIwy8IT.js";import{P as te}from"./qflIni0r.js";import{L as se}from"./D_AlXoYC.js";import"./BJZ2LJPp.js";import"./CldZMn79.js";import"./D9AGL8b1.js";import"./B8rs5dgf.js";import"./CX_9KJIV.js";const oe={class:"min-h-screen py-8 px-4 flex flex-col"},ae={class:"container mx-auto"},ne={class:"flex-1 flex items-center justify-center mt-6 mb-12"},re={class:"bg-card rounded-[2rem] p-8 w-full max-w-2xl shadow-xl border border-white/40"},ie={class:"text-2xl font-bold text-[#5d4037] text-center mb-8"},ce={class:"space-y-2"},le={class:"block text-right text-[#5d4037] font-bold pr-2"},de={class:"space-y-2"},ue={class:"block text-right text-[#5d4037] font-bold pr-2"},pe={class:"relative"},me={value:"",disabled:"",selected:""},ve=["value"],he={class:"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500"},be={class:"space-y-2"},ge={class:"block text-right text-[#5d4037] font-bold pr-2"},_e={class:"relative"},fe={value:"",disabled:"",selected:""},xe=["value"],ye={class:"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500"},we={class:"space-y-2"},Ce={class:"block text-right text-[#5d4037] font-bold pr-2"},ke={class:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"},$e={class:"border border-gray-500 rounded-full p-0.5"},Ee={class:"space-y-2"},Fe={class:"block text-right text-[#5d4037] font-bold pr-2"},Pe={class:"pt-4 w-[200px] mx-auto"},Te=["disabled"],Se={key:0},Ae={key:1,class:"flex items-center justify-center gap-2"},Ue={__name:"contracts",setup(Be){const{t:n}=I(),{api:S}=Y(),{upload:A}=Z(),y=ee(),B=j(),q=G(),v=_([]),h=_([]),b=_(!1),g=_({lat:null,lng:null}),L=U(()=>[{label:n("navigation.home"),to:"/"},{label:n("sections.medicalMaintenance.title"),to:"/profile/sections/maintaince"},{label:n("cards.maintenanceContracts.title"),active:!0}]),M=Q({contractPeriod:P().transform((e,s)=>s===""?void 0:e).typeError(n("validation.number")).required(n("validation.required")).min(1,n("validation.minNumber",{min:1})),deviceCount:P().transform((e,s)=>s===""?void 0:e).typeError(n("validation.number")).required(n("validation.required")).min(1,n("validation.minNumber",{min:1})),serviceType:x().required(n("validation.required")),location:x().required(n("validation.required")),notes:x().nullable().max(1e3,n("validation.maxNotes",{max:1e3}))}),{handleSubmit:z,errors:u,setFieldValue:N,isSubmitting:w,resetForm:V}=X({validationSchema:M,initialValues:{contractPeriod:"",deviceCount:"",serviceType:"",location:"",notes:""}});R(async()=>{try{const e=await S("/service-types-and-number-devices",{method:"GET"});console.log("Service and Devices API Response:",e),e&&e.key==="success"&&e.data?(v.value=e.data.service_types||[],h.value=e.data.number_devices||[]):e&&e.data?(v.value=e.data.service_types||[],h.value=e.data.number_devices||[]):e&&e.service_types?(v.value=e.service_types||[],h.value=e.number_devices||[]):console.warn("Unexpected API response structure:",e)}catch(e){console.error("Failed to fetch data:",e)}}),W(()=>{V(),b.value=!1,g.value={lat:null,lng:null}});const D=e=>{N("location",e.address),g.value={lat:e.lat,lng:e.lng}},C=z(async e=>{try{const s=new FormData;s.append("contract_period",e.contractPeriod),s.append("device_count",e.deviceCount),s.append("service_type_id",e.serviceType),s.append("map_desc",e.location),s.append("lat",g.value.lat||""),s.append("lng",g.value.lng||""),s.append("notes",e.notes||"");const r=await A("/orders/maintenance-contract/create-order",s);if(r&&(r.key==="success"||r.status===!0))y.success(r.msg||n("messages.success")),q.push(B("/profile/orders"));else throw new Error(r.msg||"Failed to submit order")}catch(s){console.error("Submission error:",s),y.error(s.error||s.message||n("error.somethingWentWrong"))}});return(e,s)=>(d(),l("div",oe,[t("div",ae,[a(J,{items:L.value},null,8,["items"])]),t("div",ne,[t("div",re,[t("h1",ie,i(e.$t("cards.maintenanceContracts.title")),1),t("form",{onSubmit:s[1]||(s[1]=H((...r)=>o(C)&&o(C)(...r),["prevent"])),class:"space-y-6"},[t("div",ce,[t("label",le,i(e.$t("maintenance.contracts.contractPeriod")),1),a(o(p),{name:"contractPeriod",type:"number",min:"1",placeholder:e.$t("maintenance.contracts.contractPeriod"),class:f(["w-full bg-[#F5EBE0]/80 border-0 rounded-xl py-4 px-6 text-right placeholder-gray-400 focus:ring-2 focus:ring-[#A63C12]/50 outline-none block",{"ring-2 ring-red-500/50":o(u).contractPeriod}])},null,8,["placeholder","class"]),a(o(m),{name:"contractPeriod",class:"text-red-600 text-sm block text-right pr-2"})]),t("div",de,[t("label",ue,i(e.$t("maintenance.contracts.deviceCount")),1),t("div",pe,[a(o(p),{name:"deviceCount"},{default:k(({field:r})=>[t("select",$(r,{class:["w-full bg-[#F5EBE0]/80 border-0 rounded-xl py-4 px-6 text-right placeholder-gray-400 focus:ring-2 focus:ring-[#A63C12]/50 outline-none appearance-none text-[#5d4037] h-[56px]",{"ring-2 ring-red-500/50":o(u).deviceCount}]}),[t("option",me,i(e.$t("maintenance.contracts.selectDeviceCount")),1),(d(!0),l(E,null,F(h.value,c=>(d(),l("option",{key:c,value:c},i(c),9,ve))),128))],16)]),_:1}),t("div",he,[a(o(T),{size:"20"})])]),a(o(m),{name:"deviceCount",class:"text-red-600 text-sm block text-right pr-2"})]),t("div",be,[t("label",ge,i(e.$t("maintenance.contracts.serviceType")),1),t("div",_e,[a(o(p),{name:"serviceType"},{default:k(({field:r})=>[t("select",$(r,{class:["w-full bg-[#F5EBE0]/80 border-0 rounded-xl py-4 px-6 text-right placeholder-gray-400 focus:ring-2 focus:ring-[#A63C12]/50 outline-none appearance-none text-[#5d4037] h-[56px]",{"ring-2 ring-red-500/50":o(u).serviceType}]}),[t("option",fe,i(e.$t("maintenance.contracts.selectServiceType")),1),(d(!0),l(E,null,F(v.value,c=>(d(),l("option",{key:c.id,value:c.id},i(c.name),9,xe))),128))],16)]),_:1}),t("div",ye,[a(o(T),{size:"20"})])]),a(o(m),{name:"serviceType",class:"text-red-600 text-sm block text-right pr-2"})]),t("div",we,[t("label",Ce,i(e.$t("maintenance.contracts.deviceLocation")),1),t("div",{class:"relative cursor-pointer",onClick:s[0]||(s[0]=r=>b.value=!0)},[a(o(p),{name:"location",type:"text",placeholder:e.$t("maintenance.contracts.deviceLocation"),class:f(["w-full bg-[#F5EBE0]/80 border-0 rounded-xl py-4 px-6 pl-12 text-right placeholder-gray-400 focus:ring-2 focus:ring-[#A63C12]/50 outline-none cursor-pointer",{"ring-2 ring-red-500/50":o(u).location}]),readonly:""},null,8,["placeholder","class"]),t("div",ke,[t("div",$e,[a(o(te),{size:"14"})])])]),a(o(m),{name:"location",class:"text-red-600 text-sm block text-right pr-2"})]),t("div",Ee,[t("label",Fe,i(e.$t("maintenance.contracts.notes")),1),a(o(p),{name:"notes",as:"textarea",rows:"4",placeholder:e.$t("maintenance.contracts.notes"),class:f(["w-full bg-[#F5EBE0]/80 border-0 rounded-xl py-4 px-6 text-right placeholder-gray-400 focus:ring-2 focus:ring-[#A63C12]/50 outline-none resize-none",{"ring-2 ring-red-500/50":o(u).notes}])},null,8,["placeholder","class"]),a(o(m),{name:"notes",class:"text-red-600 text-sm block text-right pr-2"})]),t("div",Pe,[t("button",{type:"submit",disabled:o(w),class:"w-full background-btn text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-xl transition-all active:scale-[0.98] disabled:opacity-70 disabled:cursor-not-allowed"},[o(w)?(d(),l("span",Ae,[O(i(e.$t("common.sending"))+" ",1),a(o(se),{class:"animate-spin",size:"20"})])):(d(),l("span",Se,i(e.$t("common.send")),1))],8,Te)])],32)])]),a(K,{"is-open":b.value,onClose:s[2]||(s[2]=r=>b.value=!1),onLocationSelected:D},null,8,["is-open"])]))}};export{Ue as default};
