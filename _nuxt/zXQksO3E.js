import{r as u,n as B,a8 as x,A as N,o as p,w,c as _,J as k,a as l,S as E,t as d,b as m,C as O,a3 as P}from"./DtlkFUv2.js";import{C as S}from"./DAYFLVbi.js";const V={class:"p-4 border-b border-gray-200 flex justify-between items-center bg-gradient-to-r from-[#bf4e26] to-[#8a320f]"},j={class:"text-white font-bold text-lg"},z={class:"flex-1 relative"},A={key:0,class:"absolute inset-0 bg-black/20 flex items-center justify-center"},F={class:"p-4 border-t border-gray-200 bg-gray-50"},T={class:"mb-3"},I={class:"block text-sm font-semibold text-gray-700 mb-1"},J={class:"bg-white border border-gray-300 rounded-lg p-3 text-gray-800 min-h-[50px] text-right"},K={class:"flex gap-3"},U=["disabled"],H={__name:"MapDialog",props:{isOpen:{type:Boolean,default:!1},initialLat:{type:Number,default:24.7136},initialLng:{type:Number,default:46.6753}},emits:["close","locationSelected"],setup(v,{emit:C}){const o=v,h=C,f=u({lat:o.initialLat,lng:o.initialLng}),s=u({lat:o.initialLat,lng:o.initialLng}),i=u(""),b=u(!1),r=async(e,a)=>{b.value=!0;try{const t=new google.maps.Geocoder,n=await new Promise((c,$)=>{t.geocode({location:{lat:e,lng:a}},(y,D)=>{D==="OK"&&y[0]?c(y[0].formatted_address):$(new Error("Geocoding failed"))})});i.value=n}catch(t){console.error("Error getting address:",t),i.value=`${e.toFixed(6)}, ${a.toFixed(6)}`}finally{b.value=!1}},L=e=>{const a=e.latLng.lat(),t=e.latLng.lng();s.value={lat:a,lng:t},r(a,t)},M=e=>{const a=e.latLng.lat(),t=e.latLng.lng();s.value={lat:a,lng:t},r(a,t)},G=()=>{h("locationSelected",{lat:s.value.lat,lng:s.value.lng,address:i.value}),g()},g=()=>{h("close")};return B(()=>o.isOpen,async e=>{if(e){f.value={lat:o.initialLat,lng:o.initialLng},s.value={lat:o.initialLat,lng:o.initialLng};const a=o.initialLat===24.7136&&o.initialLng===46.6753;navigator.geolocation&&a?navigator.geolocation.getCurrentPosition(t=>{const n=t.coords.latitude,c=t.coords.longitude;f.value={lat:n,lng:c},s.value={lat:n,lng:c},r(n,c)},t=>{console.warn("Geolocation error:",t),r(o.initialLat,o.initialLng)},{timeout:5e3}):r(o.initialLat,o.initialLng)}}),(e,a)=>{const t=x("GMapMarker"),n=x("GMapMap");return p(),N(P,{"enter-active-class":"transition duration-300 ease-out","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-200 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:w(()=>[v.isOpen?(p(),_("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:g},[l("div",{class:"bg-white w-full max-w-4xl rounded-3xl shadow-2xl border border-white/10 relative overflow-hidden flex flex-col",style:{height:"600px"},onClick:a[0]||(a[0]=E(()=>{},["stop"]))},[l("div",V,[l("h3",j,d(e.$t("cart.select_location")||"اختر الموقع على الخريطة"),1),l("button",{onClick:g,class:"text-white/80 hover:text-white transition-colors"},[m(O(S),{class:"w-6 h-6"})])]),l("div",z,[m(n,{center:f.value,zoom:12,"map-type-id":"roadmap",class:"w-full h-full",options:{zoomControl:!0,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!0,disableDefaultUI:!1},onClick:L},{default:w(()=>[m(t,{position:s.value,draggable:!0,onDragend:M},null,8,["position"])]),_:1},8,["center"]),b.value?(p(),_("div",A,a[1]||(a[1]=[l("div",{class:"bg-white/90 backdrop-blur-sm rounded-xl p-4 flex items-center gap-3"},[l("div",{class:"w-5 h-5 border-2 border-[#bf4e26]/30 border-t-[#bf4e26] rounded-full animate-spin"}),l("span",{class:"text-gray-700 font-medium"},"جاري تحديد العنوان...")],-1)]))):k("",!0)]),l("div",F,[l("div",T,[l("label",I,d(e.$t("cart.selected_address")||"العنوان المحدد"),1),l("div",J,d(i.value||e.$t("cart.click_map_to_select")||"انقر على الخريطة لتحديد الموقع"),1)]),l("div",K,[l("button",{onClick:g,class:"flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 rounded-xl transition-colors"},d(e.$t("common.cancel")||"إلغاء"),1),l("button",{onClick:G,disabled:!i.value,class:"flex-1 bg-[#bf4e26] hover:bg-[#a64420] text-white font-bold py-3 rounded-xl shadow-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},d(e.$t("common.confirm")||"تأكيد"),9,U)])])])])):k("",!0)]),_:1})}}};export{H as _};
