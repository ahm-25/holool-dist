import{_ as P}from"./C9hxFI_z.js";import{_ as S,E as $,K as z,G as E,r as v,k as K,q as M,c as _,a,L as B,C as i,b as U,t as r,F as G,B as Q,d as I,M as H,N as J,O as W,o as g,P as X,Q as Y,R as Z}from"./BnZsyVnb.js";import{u as tt,a as et}from"./C23gwpmt.js";import{u as st}from"./BAle1mHF.js";import{_ as at}from"./BFLBms6F.js";import{s as ot}from"./x_rD_Ya3.js";import"./BHcdgoKS.js";const nt=["dir"],lt={class:"w-full md:w-[50%] relative flex flex-col items-center justify-center p-6 md:p-12 z-10 overflow-y-auto"},it={class:"mt-12 md:mt-16 w-full text-center mb-10"},ct={class:"hidden md:flex justify-center mb-8"},rt=["src"],ut={class:"flex items-center justify-between"},dt={class:"text-3xl font-bold text-brand-textDark mb-2"},mt={class:"text-gray-500 text-sm font-medium"},ft={class:"w-full space-y-6"},pt={class:"flex gap-4 justify-center",dir:"ltr"},ht=["onUpdate:modelValue","onInput","onKeydown"],vt={class:"text-[#3A2A22]/80 text-sm font-semibold text-center"},_t=["disabled"],gt={key:0,class:"inline-flex items-center justify-center gap-2"},yt={key:1},xt={class:"mt-6 text-sm text-[#3A2A22]/70 text-center"},bt=["disabled"],wt={__name:"otp",setup(kt){const{t:l,locale:j}=$(),u=z(),C=E(),x=J(),m=st(),{upload:L}=tt(),{get:N}=et(),c=v(["","","",""]),p=v([]),h=v(!1),d=v(59);let y=null;K(()=>{var s,t,n;(s=u.initAuth)==null||s.call(u),(n=(t=p.value[0])==null?void 0:t.focus)==null||n.call(t),A()}),M(()=>{b()});function A(){b(),y=ot(()=>{d.value>0?d.value--:b()},1e3)}function b(){y&&clearInterval(y),y=null}const f=v(!1);async function R(){var s;if(!(f.value||d.value>0)){f.value=!0;try{const t=x.query.phone;if(!t){m.error(l("auth.otp.errors.missingPhone","رقم الجوال غير متوفر"));return}const n=await N(`/resend-code?phone=${t}`,{auth:!0});m.success((n==null?void 0:n.msg)||(n==null?void 0:n.message)||l("auth.otp.resendSuccess","تم إعادة إرسال الكود بنجاح")),d.value=59,c.value=["","","",""],(s=p.value[0])==null||s.focus(),A()}catch(t){m.error((t==null?void 0:t.error)||(t==null?void 0:t.message)||l("auth.otp.resendFailed","فشل إعادة إرسال الكود"))}finally{f.value=!1}}}function V(s){var n;const t=c.value[s].replace(/[^0-9]/g,"");c.value[s]=t,t&&s<3&&((n=p.value[s+1])==null||n.focus())}function q(s){var t;!c.value[s]&&s>0&&((t=p.value[s-1])==null||t.focus())}async function F(){var t,n,w;if(h.value)return;const s=c.value.join("").trim();if(s.length!==c.value.length){m.error(l("auth.otp.errors.completeCode","الرجاء إدخال رمز التحقق كاملاً")),D();return}h.value=!0;try{const o=new FormData;o.append("device_type",u.getDeviceType()),o.append("device_id",u.getDeviceId()),o.append("code",s),o.append("activation_code",s),x.query.phone&&o.append("phone",x.query.phone);const e=await L("/activate?_method=patch",o,{method:"POST",auth:!0});m.success((e==null?void 0:e.msg)||(e==null?void 0:e.message)||l("auth.otp.success","تم تفعيل الحساب بنجاح"));const k=((t=e==null?void 0:e.data)==null?void 0:t.token)??(e==null?void 0:e.token)??((n=e==null?void 0:e.data)==null?void 0:n.access_token)??(e==null?void 0:e.access_token),T=typeof k=="string"?k.trim():k,O=((w=e==null?void 0:e.data)==null?void 0:w.user)??(e==null?void 0:e.data)??u.user;T&&u.setAuth(T,O),await W(C("/"))}catch(o){m.error((o==null?void 0:o.error)||(o==null?void 0:o.message)||l("auth.otp.errors.failed","فشل تفعيل الحساب")),D()}finally{h.value=!1}}function D(){document.querySelectorAll(".otp-box").forEach(t=>{t.classList.add("shake"),setTimeout(()=>t.classList.remove("shake"),350)})}return(s,t)=>{const n=P;return g(),_("div",{class:"h-screen w-full flex flex-col md:flex-row",dir:i(j)==="ar"?"rtl":"ltr"},[t[2]||(t[2]=a("div",{class:"hidden h-screen md:flex flex-1 radial-gradient-subtle items-center justify-center p-12 relative overflow-hidden"},[a("div",{class:"text-center z-10"},[a("img",{src:B,alt:"logo",class:"w-56 h-48 mx-auto"})])],-1)),a("div",lt,[t[1]||(t[1]=a("div",{class:"mb-8 md:hidden"},[a("img",{src:B,alt:"logo",class:"w-24 h-20"})],-1)),a("div",it,[a("div",ct,[a("img",{src:i(at),alt:"icon",class:"w-24 h-20"},null,8,rt)]),a("div",ut,[a("div",null,[a("h2",dt,r(i(l)("auth.otp.title","كود التحقق")),1),a("p",mt,r(i(l)("auth.otp.subtitle","قم بإدخال الكود المرسل على رقم جوالك")),1)]),U(n,{variant:"auth",size:"sm"})])]),a("div",ft,[a("div",pt,[(g(!0),_(G,null,Q(c.value,(w,o)=>X((g(),_("input",{key:o,ref_for:!0,ref_key:"otpRefs",ref:p,"onUpdate:modelValue":e=>c.value[o]=e,maxlength:"1",inputmode:"numeric",class:"otp-box w-14 h-14 rounded-xl border-none bg-[#E9DCD6]/80 text-[#3A2A22] text-2xl font-bold text-center focus:outline-none focus:ring-2 focus:ring-[#B54628]/30 shadow-sm transition-all",onInput:e=>V(o),onKeydown:Z(e=>q(o),["backspace"])},null,40,ht)),[[Y,c.value[o]]])),128))]),a("div",vt,r(i(l)("auth.otp.remainingTime","الوقت المتبقي"))+" : "+r(d.value)+" "+r(i(l)("common.seconds","ثانية")),1),a("button",{onClick:F,disabled:h.value,class:"w-full !py-4 back-btn transition transform hover:-translate-y-1 mt-4 disabled:opacity-50 disabled:cursor-not-allowed"},[h.value?(g(),_("span",gt,[t[0]||(t[0]=a("span",{class:"inline-block w-5 h-5 rounded-full border-2 border-white/40 border-t-white animate-spin"},null,-1)),I(" "+r(i(l)("auth.otp.verifying","جاري التحقق...")),1)])):(g(),_("span",yt,r(i(l)("auth.otp.verify","تحقق")),1))],8,_t),a("div",xt,[I(r(i(l)("auth.otp.didNotReceive","لم تستلم الرمز؟"))+" ",1),a("button",{onClick:R,disabled:f.value||d.value>0,class:H(["font-bold hover:underline cursor-pointer mx-1 transition-colors",f.value||d.value>0?"text-gray-400 cursor-not-allowed no-underline":"text-[#B54628]"])},r(f.value?i(l)("common.sending","جاري الإرسال..."):i(l)("auth.otp.resend","إعادة الإرسال")),11,bt)])])])],8,nt)}}},Lt=S(wt,[["__scopeId","data-v-21937c64"]]);export{Lt as default};
